const express = require('express');\nconst http = require('http');\nconst expressWs = require('express-ws');\nconst pty = require('node-pty');\nconst os = require('os');\n\n// Determine the shell based on the OS.\nconst shell = os.platform() === 'win32' ? 'powershell.exe' : 'bash';\n\nconst app = express();\nconst server = http.createServer(app);\nconst wss = expressWs(app, server);\n\nconst port = 3000;\n\n// Serve static files from the current directory\napp.use(express.static(__dirname));\n\n// Handle WebSocket connections\napp.ws('/shell', (ws, req) => {\n  console.log('New WebSocket connection established.');\n\n  // Spawn a new pseudo-terminal\n  const term = pty.spawn(shell, [], {\n    name: 'xterm-color',\n    cols: 80,\n    rows: 30,\n    cwd: process.env.HOME,\n    env: process.env\n  });\n\n  console.log(`PTY created with PID: ${term.pid}`);\n\n  // Pipe PTY output to WebSocket\n  term.on('data', (data) => {\n    try {\n      ws.send(data);\n    } catch (e) {\n      console.error('Error sending data to WebSocket:', e);\n    }\n  });\n\n  // Pipe WebSocket input to PTY\n  ws.on('message', (msg) => {\n    term.write(msg);\n  });\n\n  // Handle connection close\n  ws.on('close', () => {\n    console.log(`WebSocket connection closed. Killing PTY with PID: ${term.pid}`);\n    term.kill();\n  });\n\n  // Handle PTY exit\n  term.on('exit', (code, signal) => {\n      console.log(`PTY process exited with code ${code}, signal ${signal}`);\n      if (ws.readyState === ws.OPEN) {\n          ws.close();\n      }\n  });\n});\n\nserver.listen(port, () => {\n  console.log(`Server listening on http://localhost:${port}`);\n  console.log(`WebSocket endpoint available at ws://localhost:${port}/shell`);\n});