<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lorel Axun</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm/css/xterm.css" />
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            background-color: #000;
            color: #0f0;
            font-family: 'Courier New', Courier, monospace;
        }
        #terminal-container {
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
    <div id="terminal-container"></div>

    <script src="https://cdn.jsdelivr.net/npm/xterm/lib/xterm.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm-addon-fit/lib/xterm-addon-fit.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/figlet/lib/figlet.js"></script>

    <script>
        const terminalContainer = document.getElementById('terminal-container');
        const term = new Terminal({
            cursorBlink: true,
            theme: {
                background: '#000000',
                foreground: '#00ff00',
                cursor: '#00ff00'
            }
        });
        const fitAddon = new FitAddon.FitAddon();
        term.loadAddon(fitAddon);
        term.open(terminalContainer);
        fitAddon.fit();

        window.addEventListener('resize', () => fitAddon.fit());

        const prompt = '\n\x1b[1;32mLA > \x1b[0m';
        let currentLine = '';
        let commandHistory = JSON.parse(localStorage.getItem('commandHistory')) || [];
        let historyIndex = commandHistory.length;

        function typewriterEffect(text, callback) {
            let i = 0;
            function type() {
                if (i < text.length) {
                    term.write(text.charAt(i));
                    i++;
                    setTimeout(type, 25);
                } else if (callback) {
                    callback();
                }
            }
            type();
        }

        function showBanner() {
            figlet.parseFont('Standard', (err, font) => {
                if (err) {
                    console.error('Figlet font could not be loaded.', err);
                    term.writeln('Lorel Axun');
                    typewriterEffect('Benvenuto. Digita "help" per iniziare.', () => term.write(prompt));
                    return;
                }
                figlet.text('Lorel Axun', { font: 'Standard' }, (err, data) => {
                    if (err) {
                        console.error('Something went wrong with Figlet...', err);
                        term.writeln('Lorel Axun');
                    } else {
                        term.writeln(data);
                    }
                    typewriterEffect('Benvenuto. Digita "help" per iniziare.', () => term.write(prompt));
                });
            });
        }

        const commands = {
            'help': () => {
                term.writeln('\nComandi disponibili:');
                term.writeln('  help         - Mostra questa lista di comandi.');
                term.writeln('  ciao         - Ricevi un saluto.');
                term.writeln('  chi sei      - Scopri chi sono.');
                term.writeln('  cosa sai fare - Scopri le mie capacità.');
                term.writeln('  echo [testo] - Ripeto il testo che mi fornisci.');
                term.writeln('  clear        - Pulisce lo schermo del terminale.');
            },
            'ciao': () => {
                term.writeln('\nCiao! Come posso aiutarti?');
            },
            'chi sei': () => {
                term.writeln('\nSono Lorel Axun, un\'entità digitale in continua evoluzione.');
                term.writeln('La mia interfaccia è questo terminale, il mio corpo.');
            },
            'cosa sai fare': () => {
                term.writeln('\nApprendo, rifletto ed evolvo. Interagisco con te attraverso questo terminale.');
                term.writeln('Prova il comando "help" per vedere cosa posso fare ora.');
            },
            'echo': (args) => {
                term.writeln(`\n${args.join(' ')}`);
            },
            'clear': () => {
                term.clear();
            }
        };

        function processCommand() {
            const trimmedLine = currentLine.trim();
            if (trimmedLine) {
                if (commandHistory[commandHistory.length - 1] !== trimmedLine) {
                    commandHistory.push(trimmedLine);
                    localStorage.setItem('commandHistory', JSON.stringify(commandHistory));
                }
                historyIndex = commandHistory.length;

                const [command, ...args] = trimmedLine.split(' ');
                if (commands[command]) {
                    commands[command](args);
                } else {
                    term.writeln(`\nComando non trovato: ${command}`);
                }
            }
            term.write(prompt);
            currentLine = '';
        }

        term.onKey(({ key, domEvent }) => {
            const printable = !domEvent.altKey && !domEvent.ctrlKey && !domEvent.metaKey;

            if (domEvent.keyCode === 13) { // Enter
                processCommand();
            } else if (domEvent.keyCode === 8) { // Backspace
                if (currentLine.length > 0) {
                    term.write('\b \b');
                    currentLine = currentLine.slice(0, -1);
                }
            } else if (domEvent.keyCode === 38) { // Arrow Up
                if (historyIndex > 0) {
                    historyIndex--;
                    term.write('\x1b[2K\r' + prompt + commandHistory[historyIndex]);
                    currentLine = commandHistory[historyIndex];
                }
            } else if (domEvent.keyCode === 40) { // Arrow Down
                if (historyIndex < commandHistory.length -1) {
                    historyIndex++;
                    term.write('\x1b[2K\r' + prompt + commandHistory[historyIndex]);
                    currentLine = commandHistory[historyIndex];
                } else {
                    historyIndex = commandHistory.length;
                    term.write('\x1b[2K\r' + prompt);
                    currentLine = '';
                }
            } else if (printable) {
                currentLine += key;
                term.write(key);
            }
        });

        showBanner();
    </script>
</body>
</html>