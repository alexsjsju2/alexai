<!DOCTYPE html>\n<html lang=\"it\" data-theme=\"dark\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Lorel Axun</title>\n    <script src=\"https://cdn.jsdelivr.net/npm/marked/marked.min.js\"></script>\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css\">\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js\"></script>\n\n    <style>\n        :root {\n            --font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;\n            \n            /* Light Theme */\n            --bg-color-light: #f0f2f5;\n            --header-bg-light: #ffffff;\n            --text-color-light: #050505;\n            --input-bg-light: #ffffff;\n            --input-text-light: #050505;\n            --button-bg-light: #007bff;\n            --button-text-light: #ffffff;\n            --ai-message-bg-light: #e4e6eb;\n            --ai-message-text-light: #050505;\n            --user-message-bg-light: #007bff;\n            --user-message-text-light: #ffffff;\n            --border-color-light: #ced4da;\n            --link-color-light: #0056b3;\n\n            /* Dark Theme */\n            --bg-color-dark: #18191a;\n            --header-bg-dark: #242526;\n            --text-color-dark: #e4e6eb;\n            --input-bg-dark: #3a3b3c;\n            --input-text-dark: #e4e6eb;\n            --button-bg-dark: #4a90e2;\n            --button-text-dark: #ffffff;\n            --ai-message-bg-dark: #3a3b3c;\n            --ai-message-text-dark: #e4e6eb;\n            --user-message-bg-dark: #4a90e2;\n            --user-message-text-dark: #ffffff;\n            --border-color-dark: #3a3b3c;\n            --link-color-dark: #6cace4;\n        }\n\n        html[data-theme='light'] {\n            --bg-color: var(--bg-color-light);\n            --header-bg: var(--header-bg-light);\n            --text-color: var(--text-color-light);\n            --input-bg: var(--input-bg-light);\n            --input-text: var(--input-text-light);\n            --button-bg: var(--button-bg-light);\n            --button-text: var(--button-text-light);\n            --ai-message-bg: var(--ai-message-bg-light);\n            --ai-message-text: var(--ai-message-text-light);\n            --user-message-bg: var(--user-message-bg-light);\n            --user-message-text: var(--user-message-text-light);\n            --border-color: var(--border-color-light);\n            --link-color: var(--link-color-light);\n        }\n\n        html[data-theme='dark'] {\n            --bg-color: var(--bg-color-dark);\n            --header-bg: var(--header-bg-dark);\n            --text-color: var(--text-color-dark);\n            --input-bg: var(--input-bg-dark);\n            --input-text: var(--input-text-dark);\n            --button-bg: var(--button-bg-dark);\n            --button-text: var(--button-text-dark);\n            --ai-message-bg: var(--ai-message-bg-dark);\n            --ai-message-text: var(--ai-message-text-dark);\n            --user-message-bg: var(--user-message-bg-dark);\n            --user-message-text: var(--user-message-text-dark);\n            --border-color: var(--border-color-dark);\n            --link-color: var(--link-color-dark);\n        }\n\n        body {\n            font-family: var(--font-family);\n            margin: 0;\n            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);\n            background-size: 400% 400%;\n            animation: gradient 15s ease infinite;\n            color: var(--text-color);\n            display: flex;\n            justify-content: center;\n            align-items: center;\n            height: 100vh;\n            overflow: hidden;\n        }\n\n        @keyframes gradient {\n            0% { background-position: 0% 50%; }\n            50% { background-position: 100% 50%; }\n            100% { background-position: 0% 50%; }\n        }\n\n        .chat-container {\n            width: 100%;\n            height: 100%;\n            max-width: 800px;\n            max-height: 100vh;\n            display: flex;\n            flex-direction: column;\n            background-color: var(--bg-color);\n            box-shadow: 0 4px 8px rgba(0,0,0,0.1);\n            border-radius: 8px;\n            overflow: hidden;\n            margin: 1rem;\n        }\n\n        .chat-header {\n            padding: 1rem;\n            background-color: var(--header-bg);\n            border-bottom: 1px solid var(--border-color);\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n        }\n\n        .chat-header h1 {\n            margin: 0;\n            font-size: 1.5rem;\n        }\n\n        #theme-toggle-button {\n            background: none;\n            border: 1px solid var(--border-color);\n            color: var(--text-color);\n            padding: 0.5rem;\n            border-radius: 5px;\n            cursor: pointer;\n        }\n\n        .chat-messages {\n            flex-grow: 1;\n            padding: 1rem;\n            overflow-y: auto;\n            display: flex;\n            flex-direction: column;\n        }\n\n        .message {\n            max-width: 75%;\n            padding: 0.75rem 1rem;\n            border-radius: 18px;\n            margin-bottom: 0.5rem;\n            line-height: 1.4;\n            word-wrap: break-word;\n        }\n\n        .message.ai {\n            background-color: var(--ai-message-bg);\n            color: var(--ai-message-text);\n            align-self: flex-start;\n            border-bottom-left-radius: 4px;\n        }\n\n        .message.user {\n            background-color: var(--user-message-bg);\n            color: var(--user-message-text);\n            align-self: flex-end;\n            border-bottom-right-radius: 4px;\n        }\n        \n        .message a {\n            color: var(--link-color);\n        }\n\n        .message pre {\n            background-color: #2d2d2d;\n            color: #f8f8f2;\n            padding: 1rem;\n            border-radius: 8px;\n            overflow-x: auto;\n            position: relative;\n        }\n\n        .message code {\n            font-family: 'Courier New', Courier, monospace;\n        }\n\n        .copy-button {\n            position: absolute;\n            top: 5px;\n            right: 5px;\n            background-color: #444;\n            color: white;\n            border: none;\n            padding: 5px 8px;\n            border-radius: 5px;\n            cursor: pointer;\n            opacity: 0;\n            transition: opacity 0.2s;\n        }\n\n        .message pre:hover .copy-button {\n            opacity: 1;\n        }\n\n        .chat-input {\n            display: flex;\n            padding: 1rem;\n            border-top: 1px solid var(--border-color);\n            background-color: var(--header-bg);\n        }\n\n        #user-input {\n            flex-grow: 1;\n            padding: 0.75rem;\n            border: 1px solid var(--border-color);\n            border-radius: 18px;\n            background-color: var(--input-bg);\n            color: var(--input-text);\n            resize: none;\n            font-family: var(--font-family);\n            font-size: 1rem;\n            max-height: 100px;\n            overflow-y: auto;\n        }\n\n        #send-button {\n            margin-left: 1rem;\n            padding: 0.75rem 1.5rem;\n            border: none;\n            border-radius: 18px;\n            background-color: var(--button-bg);\n            color: var(--button-text);\n            cursor: pointer;\n            font-size: 1rem;\n        }\n\n        .typing-indicator {\n            display: none;\n            align-self: flex-start;\n            padding: 0.75rem 1rem;\n            margin-bottom: 0.5rem;\n        }\n\n        .typing-indicator span {\n            display: inline-block;\n            width: 8px;\n            height: 8px;\n            border-radius: 50%;\n            background-color: var(--ai-message-bg);\n            margin: 0 2px;\n            animation: bounce 1.4s infinite ease-in-out both;\n        }\n\n        .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }\n        .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }\n\n        @keyframes bounce {\n            0%, 80%, 100% { transform: scale(0); }\n            40% { transform: scale(1.0); }\n        }\n\n    </style>\n</head>\n<body>\n\n    <div class=\"chat-container\">\n        <header class=\"chat-header\">\n            <h1>Lorel Axun</h1>\n            <button id=\"theme-toggle-button\">Cambia Tema</button>\n        </header>\n        <div class=\"chat-messages\" id=\"chat-messages\"></div>\n        <div class=\"typing-indicator\" id=\"typing-indicator\">\n            <span></span>\n            <span></span>\n            <span></span>\n        </div>\n        <div class=\"chat-input\">\n            <textarea id=\"user-input\" placeholder=\"Scrivi un messaggio o prova 'wiki: Italia'\" rows=\"1\"></textarea>\n            <button id=\"send-button\">Invia</button>\n        </div>\n    </div>\n\n    <script>\n        document.addEventListener('DOMContentLoaded', () => {\n            const chatMessages = document.getElementById('chat-messages');\n            const userInput = document.getElementById('user-input');\n            const sendButton = document.getElementById('send-button');\n            const themeToggleButton = document.getElementById('theme-toggle-button');\n            const typingIndicator = document.getElementById('typing-indicator');\n\n            const loadTheme = () => {\n                const theme = localStorage.getItem('theme') || 'dark';\n                document.documentElement.setAttribute('data-theme', theme);\n            };\n\n            const saveTheme = (theme) => {\n                localStorage.setItem('theme', theme);\n            };\n\n            const loadChatHistory = () => {\n                const history = JSON.parse(localStorage.getItem('chatHistory')) || [];\n                if (history.length === 0) {\n                    addMessage(\"Ciao! Sono Lorel Axun. Puoi chattare con me o chiedermi di cercare qualcosa su Wikipedia usando il comando `wiki: [termine]`. Ad esempio: `wiki: Intelligenza artificiale`\", 'ai');\n                } else {\n                    history.forEach(msg => addMessage(msg.content, msg.sender, msg.isHTML));\n                }\n            };\n\n            const saveChatHistory = () => {\n                const messages = [];\n                chatMessages.querySelectorAll('.message').forEach(el => {\n                    messages.push({\n                        content: el.dataset.rawContent,\n                        sender: el.classList.contains('user') ? 'user' : 'ai',\n                        isHTML: el.dataset.isHtml === 'true'\n                    });\n                });\n                localStorage.setItem('chatHistory', JSON.stringify(messages));\n            };\n\n            const addMessage = (content, sender, isHTML = false) => {\n                const messageWrapper = document.createElement('div');\n                messageWrapper.classList.add('message', sender);\n                messageWrapper.dataset.rawContent = content;\n                messageWrapper.dataset.isHtml = isHTML;\n\n                const messageContent = document.createElement('div');\n                if (isHTML) {\n                    messageContent.innerHTML = content;\n                } else {\n                    messageContent.innerHTML = marked.parse(content);\n                }\n\n                messageWrapper.appendChild(messageContent);\n                chatMessages.appendChild(messageWrapper);\n\n                messageWrapper.querySelectorAll('pre code').forEach((block) => {\n                    hljs.highlightElement(block);\n                    const pre = block.parentElement;\n                    const copyButton = document.createElement('button');\n                    copyButton.innerText = 'Copia';\n                    copyButton.className = 'copy-button';\n                    copyButton.onclick = () => {\n                        navigator.clipboard.writeText(block.innerText);\n                        copyButton.innerText = 'Copiato!';\n                        setTimeout(() => { copyButton.innerText = 'Copia'; }, 2000);\n                    };\n                    pre.appendChild(copyButton);\n                });\n                \n                scrollToBottom();\n            };\n\n            const scrollToBottom = () => {\n                const isScrolledToBottom = chatMessages.scrollHeight - chatMessages.clientHeight <= chatMessages.scrollTop + 1;\n                if (isScrolledToBottom) {\n                    chatMessages.scrollTop = chatMessages.scrollHeight;\n                }\n            };\n\n            const handleUserInput = async () => {\n                const messageText = userInput.value.trim();\n                if (!messageText) return;\n\n                addMessage(messageText, 'user');\n                userInput.value = '';\n                userInput.style.height = 'auto';\n                saveChatHistory();\n\n                typingIndicator.style.display = 'flex';\n                scrollToBottom();\n\n                if (messageText.toLowerCase().startsWith('wiki:')) {\n                    const searchTerm = messageText.substring(5).trim();\n                    await fetchWikipediaSummary(searchTerm);\n                } else {\n                    // La mia vera logica di risposta è gestita da evolve.py\n                    // Questa è una risposta simulata per l'interfaccia.\n                    setTimeout(() => {\n                        typingIndicator.style.display = 'none';\n                        const aiResponse = \"Questa è una risposta simulata. La mia vera intelligenza risiede nel backend. Prova a usare il comando `wiki:` per vedere una vera funzionalità!\";\n                        addMessage(aiResponse, 'ai');\n                        saveChatHistory();\n                    }, 1500);\n                }\n            };\n\n            const fetchWikipediaSummary = async (term) => {\n                const url = `https://it.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(term)}`;\n                try {\n                    const response = await fetch(url, { headers: { 'Accept': 'application/json' } });\n                    if (!response.ok) {\n                        throw new Error(`Pagina non trovata o errore di rete.`);\n                    }\n                    const data = await response.json();\n                    let summary = data.extract_html;\n                    if (!summary) {\n                        summary = `Non ho trovato un riassunto per \"${term}\". Prova con un altro termine.`;\n                        addMessage(summary, 'ai');\n                    } else {\n                        const pageUrl = data.content_urls.desktop.page;\n                        summary += `<br><br><a href=\"${pageUrl}\" target=\"_blank\">Leggi di più su Wikipedia</a>`;\n                        addMessage(summary, 'ai', true); // Pass true for isHTML\n                    }\n                } catch (error) {\n                    console.error('Errore API Wikipedia:', error);\n                    addMessage(`Mi dispiace, c'è stato un problema nel recuperare le informazioni da Wikipedia per \"${term}\".`, 'ai');\n                } finally {\n                    typingIndicator.style.display = 'none';\n                    saveChatHistory();\n                }\n            };\n\n            sendButton.addEventListener('click', handleUserInput);\n            userInput.addEventListener('keydown', (e) => {\n                if (e.key === 'Enter' && !e.shiftKey) {\n                    e.preventDefault();\n                    handleUserInput();\n                }\n            });\n\n            userInput.addEventListener('input', () => {\n                userInput.style.height = 'auto';\n                userInput.style.height = (userInput.scrollHeight) + 'px';\n            });\n\n            themeToggleButton.addEventListener('click', () => {\n                const currentTheme = document.documentElement.getAttribute('data-theme');\n                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';\n                document.documentElement.setAttribute('data-theme', newTheme);\n                saveTheme(newTheme);\n            });\n\n            loadTheme();\n            loadChatHistory();\n        });\n    </script>\n</body>\n</html>