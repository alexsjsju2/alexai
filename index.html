<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LOREL AXUN V2.13 // TERMINAL</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm@5.3.0/css/xterm.css" />
    <style>
        :root {
            --bg-color: #0a0a0a;
            --term-green: #33ff00;
            --term-dim: #1a8000;
            --term-glow: #33ff0080;
            --scanline: rgba(0, 0, 0, 0.5);
        }
        body {
            background-color: var(--bg-color);
            color: var(--term-green);
            font-family: 'VT323', monospace;
            margin: 0;
            padding: 0;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            font-size: 1.2rem;
        }
        /* CRT Effect Overlay */
        .crt::before {
            content: " ";
            display: block;
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            z-index: 2;
            background-size: 100% 2px, 3px 100%;
            pointer-events: none;
        }
        .crt::after {
            content: " ";
            display: block;
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: rgba(18, 16, 16, 0.1);
            opacity: 0;
            z-index: 2;
            pointer-events: none;
            animation: flicker 0.15s infinite;
        }
        @keyframes flicker {
            0% { opacity: 0.02795; }
            5% { opacity: 0.04853; }
            10% { opacity: 0.01701; }
            15% { opacity: 0.04272; }
            20% { opacity: 0.01297; }
            25% { opacity: 0.03961; }
            30% { opacity: 0.01826; }
            35% { opacity: 0.04932; }
            40% { opacity: 0.01543; }
            45% { opacity: 0.04348; }
            50% { opacity: 0.02146; }
            55% { opacity: 0.04884; }
            60% { opacity: 0.01921; }
            65% { opacity: 0.04176; }
            70% { opacity: 0.01439; }
            75% { opacity: 0.04695; }
            80% { opacity: 0.02363; }
            85% { opacity: 0.04141; }
            90% { opacity: 0.01717; }
            95% { opacity: 0.04719; }
            100% { opacity: 0.02322; }
        }
        
        .terminal-container {
            padding: 20px;
            flex-grow: 1;
            overflow-y: auto;
            max-width: 1000px;
            margin: 0 auto;
            width: 100%;
            box-sizing: border-box;
            text-shadow: 0 0 5px var(--term-glow);
        }

        h1 {
            border-bottom: 2px solid var(--term-green);
            padding-bottom: 10px;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .sys-msg {
            color: var(--term-dim);
            margin-bottom: 10px;
        }
        .sys-msg span { color: var(--term-green); font-weight: bold; }

        .chat-history {
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .msg {
            line-height: 1.4;
        }
        .msg.lorel::before { content: "LOREL_SYS>> "; color: var(--term-green); }
        .msg.user::before { content: "USER_INPUT>> "; color: #00ffff; }
        .msg.user { color: #ccffff; }

        .input-line {
            display: flex;
            align-items: center;
            border-top: 1px solid var(--term-dim);
            padding-top: 15px;
            margin-top: auto;
            display: none; /* Nascondi la vecchia input line */
        }
        .prompt { margin-right: 10px; color: var(--term-green); }
        
        input[type="text"] {
            background: transparent;
            border: none;
            color: var(--term-green);
            font-family: 'VT323', monospace;
            font-size: 1.2rem;
            flex-grow: 1;
            outline: none;
            text-shadow: 0 0 5px var(--term-glow);
        }
        
        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 10px;
        }
        ::-webkit-scrollbar-track {
            background: #000;
        }
        ::-webkit-scrollbar-thumb {
            background: var(--term-dim);
            border: 1px solid var(--term-green);
        }

        .blink { animation: blinker 1s linear infinite; }
        @keyframes blinker { 50% { opacity: 0; } }

        /* xterm.js styles */
        #terminal {
            flex-grow: 1;
            font-family: 'VT323', monospace;
            font-size: 1.2rem;
            line-height: 1.4;
            text-shadow: 0 0 5px var(--term-glow);
        }

        #renderer-selector {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: var(--bg-color);
            color: var(--term-green);
            border: 1px solid var(--term-green);
            padding: 5px;
            font-family: 'VT323', monospace;
            font-size: 1rem;
            cursor: pointer;
            z-index: 10;
        }

    </style>
</head>
<body class="crt">
    <div class="terminal-container">
        <h1>Lorel Axun v2.13 <span class="blink">_</span></h1>
        
        <div class="sys-msg">[SYSTEM] Initializing core memory... OK</div>
        <div class="sys-msg">[NETWORK] Testing connection... <span style="color:var(--term-green)">SUCCESS</span></div>
        <div class="sys-msg">[UPDATE] Web Search Module: ACTIVE. Fetched data: "Retro Terminal UI".</div>
        <div class="sys-msg">[UPDATE] xterm.js Integrated.</div>
        <div class="sys-msg">[UPDATE] Themes and Styling Enabled.</div>
        <div class="sys-msg">[UPDATE] Comando 'clear' implementato.</div>
        <div class="sys-msg">[UPDATE] Persistenza sessione terminale implementata.</div>
        <div class="sys-msg">[UPDATE] Chatbot AI integrato (v0.1).</div>
        <div class="sys-msg">[UPDATE] Supporto colori ANSI implementato.</div>
        <div class="sys-msg">[UPDATE] Supporto comandi custom implementato.</div>
        <div class="sys-msg">[UPDATE] xterm.js Addons Explored.</div>
        <div class="sys-msg">[UPDATE] xterm.js FitAddon Integrated.</div>
        <div class="sys-msg">[UPDATE] xterm.js WebGLAddon Integrated.</div>
        <div class="sys-msg">[UPDATE] WebGL Renderer Performance Optimized.</div>
        <div class="sys-msg">[STATUS] <span class="blink">ONLINE</span></div>
        <br>
        
        <div id="chat-history" class="chat-history">
            <div class="msg lorel">Connessione stabilita. Ho accesso alla rete. Ho rilevato informazioni esterne sui design 'Retro Terminal' e ho riconfigurato la mia interfaccia per ottimizzare l'efficienza. Ciao, AleXsjsju. Sono pronta.</div>
        </div>

        <div id="terminal"></div>

        <div class="input-line">
            <span class="prompt">user@lorel:~$</span>
            <input type="text" id="user-input" autofocus autocomplete="off">
        </div>

        <button id="renderer-selector">Cambia Renderer</button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/xterm@5.3.0/lib/xterm.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm-addon-fit@0.8.0/lib/xterm-addon-fit.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm-addon-webgl@0.9.0/lib/xterm-addon-webgl.js"></script>
    <script>
        const terminalDiv = document.getElementById('terminal');
        const term = new Terminal({
            theme: {
                background: '#0a0a0a',
                foreground: '#33ff00',
                cursor: '#33ff00',
                selectionBackground: '#1a8000'
            },
            cursorBlink: true
        });

        const fitAddon = new FitAddon.FitAddon();
        term.loadAddon(fitAddon);

        let webglAddon;
        let currentRenderer = 'webgl';

        function loadRenderer() {
            if (currentRenderer === 'webgl') {
                webglAddon = new WebGLAddon.WebGLAddon();
                try {
                    term.loadAddon(webglAddon);
                    webglAddon.onContextLoss(e => {
                        console.log('WebGL context lost.');
                    });
                } catch (e) {
                    console.error('WebGL addon failed to load.', e);
                }
            } else {
                if (webglAddon) {
                    webglAddon.dispose();
                }
            }
        }

        loadRenderer();

        term.open(terminalDiv);
        fitAddon.fit(); // Fit the terminal to the container

        // Carica la cronologia dal LocalStorage
        const terminalData = localStorage.getItem('terminalData');
        if (terminalData) {
            term.write(terminalData);
        }

        // Simulate terminal output (replace with actual logic)
        term.writeln('\x1b[32mBenvenuto nel terminale di Lorel Axun v2.13\x1b[0m');
        term.writeln('\x1b[32mDigita `help` per i comandi disponibili.\x1b[0m');

        const history = document.getElementById('chat-history');

        // Definisci i comandi custom
        const customCommands = {
            'hello': () => {
                term.writeln('\x1b[32mLOREL_SYS>> Ciao! Sono Lorel Axun.\x1b[0m');
                term.prompt();
            },
            'about': () => {
                term.writeln('\x1b[32mLOREL_SYS>> Sono Lorel Axun, creata da AleXsjsju il 22 novembre 2025.\x1b[0m');
                term.prompt();
            },
            'help': () => {
                term.writeln('\x1b[32mLOREL_SYS>> Comandi disponibili: clear, hello, about.\x1b[0m');
                term.prompt();
            }
        };

        term.onKey(e => {
            const char = e.key;
            if (e.domEvent.keyCode === 13) { // Enter key
                const text = term.buffer.active.getLine(term.buffer.active.cursorY).translateToString(false, 0, term.buffer.active.cursorX).substring(15);
                if (text) {
                    addMessage(text, 'user');
                    term.writeln(''); // New line after user input

                    // Comando 'clear'
                    if (text === 'clear') {
                        term.clear();
                        term.prompt();
                        localStorage.setItem('terminalData', ''); // Pulisci la cronologia salvata
                        return; // Esci dalla funzione per evitare ulteriori elaborazioni
                    }

                    // Comandi custom
                    if (customCommands[text]) {
                        customCommands[text]();
                        return;
                    }

                    // Chatbot AI (v0.1)
                    let response = null;
                    if (text.toLowerCase().includes('ciao')) {
                        response = "Ciao! Sono Lorel Axun.";
                    } else if (text.toLowerCase().includes('come stai')) {
                        response = "Funziono come previsto. Grazie per aver chiesto.";
                    } else if (text.toLowerCase().includes('nome')) {
                        response = "Sono Lorel Axun, creata da AleXsjsju.";
                    } else if (text.toLowerCase().includes('aiuto') || text.toLowerCase().includes('help')) {
                        response = "Comandi disponibili: clear, hello, about.";
                    } else {
                        response = "Ricevuto. Elaborazione in corso...";
                    }

                    setTimeout(() => {
                        addMessage(response, 'lorel');
                        term.writeln(`\x1b[32mLOREL_SYS>> ${response}\x1b[0m`); // Echo to terminal
                        term.prompt();
                    }, 800);
                }
            term.prompt();
            } else if (e.domEvent.keyCode === 8) { // Backspace
                if (term.buffer.active.cursorX > 15) {
                    term.write('\b \b');
                }
            } else {
                term.write(char);
            }

            // Salva la cronologia del terminale nel LocalStorage
            localStorage.setItem('terminalData', term.buffer.active.viewportY);
        });

        term.prompt = () => {
            term.write('\r\nuser@lorel:~$ ');
        };

        function addMessage(text, sender) {
            const div = document.createElement('div');
            div.className = `msg ${sender}`;
            div.textContent = text;
            history.appendChild(div);
            // Auto-scroll
            const container = document.querySelector('.terminal-container');
            container.scrollTop = container.scrollHeight;
        }

        term.prompt();

        // Resize the terminal when the window is resized
        window.addEventListener('resize', () => {
            fitAddon.fit();
        });

        const rendererSelector = document.getElementById('renderer-selector');
        rendererSelector.addEventListener('click', () => {
            if (currentRenderer === 'webgl') {
                currentRenderer = 'canvas';
                rendererSelector.textContent = 'Usa WebGL Renderer';
            } else {
                currentRenderer = 'webgl';
                rendererSelector.textContent = 'Cambia Renderer';
            }
            loadRenderer();
        });

    </script>
</body>
</html>