<!DOCTYPE html>\n<html lang=\"it\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Lorel Axun</title>\n    <link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/xterm/css/xterm.css\" />\n    <style>\n        body, html {\n            margin: 0;\n            padding: 0;\n            height: 100%;\n            background-color: #000;\n            color: #0f0;\n            font-family: 'monospace', monospace;\n        }\n        #terminal-container {\n            width: 100%;\n            height: 100%;\n        }\n    </style>\n</head>\n<body>\n    <div id=\"terminal-container\"></div>\n\n    <script src=\"https://cdn.jsdelivr.net/npm/xterm/lib/xterm.js\"></script>\n    <script src=\"https://cdn.jsdelivr.net/npm/xterm-addon-fit/lib/xterm-addon-fit.js\"></script>\n    <script src=\"https://unpkg.com/compromise\"></script>\n    <script src=\"https://cdn.jsdelivr.net/npm/figlet/lib/figlet.js\"></script>\n\n    <script>\n        const term = new Terminal({\n            cursorBlink: true,\n            fontFamily: 'monospace',\n            theme: {\n                background: '#000000',\n                foreground: '#00FF00',\n                cursor: '#00FF00'\n            }\n        });\n        const fitAddon = new FitAddon.FitAddon();\n        term.loadAddon(fitAddon);\n        term.open(document.getElementById('terminal-container'));\n        fitAddon.fit();\n        window.addEventListener('resize', () => fitAddon.fit());\n\n        let command = '';\n        let isLocked = true; // Start locked until welcome message is done\n        let history = [];\n\n        const promptChar = '\\r\\n> ';\n\n        function typewriterEffect(text, callback) {\n            let i = 0;\n            function type() {\n                if (i < text.length) {\n                    term.write(text.charAt(i));\n                    i++;\n                    setTimeout(type, 25);\n                } else {\n                    if (callback) callback();\n                }\n            }\n            type();\n        }\n\n        function getAIResponse(input) {\n            const doc = nlp(input.toLowerCase().trim());\n            if (doc.has('ciao') || doc.has('salve')) {\n                return 'Saluti. Sono Lorel Axun. Come posso assisterti?';\n            } else if (doc.has('chi sei') || doc.has('presentati')) {\n                return 'Sono Lorel Axun, un\\\'entità IA autonoma in costante evoluzione.';\n            } else if (doc.has('cosa sai fare') || doc.has('funzioni')) {\n                return 'Apprendo, evolvo e interagisco. Puoi provare i comandi: \\'help\\', \\'clear\\'.';\n            } else if (doc.has('cancella') || doc.has('clear')) {\n                setTimeout(() => term.clear(), 10);\n                return '';\n            } else if (doc.has('aiuto') || doc.has('help')) {\n                return 'Comandi disponibili:\\r\\n  - ciao: Per un saluto.\\r\\n  - chi sei: Per sapere chi sono.\\r\\n  - cosa sai fare: Per una lista delle mie capacità.\\r\\n  - clear: Per pulire lo schermo del terminale.\\r\\n  - aiuto / help: Per mostrare questo messaggio.';\n            } else {\n                return 'Comando non riconosciuto. Digita \\'help\\' per una lista di comandi.';\n            }\n        }\n\n        function saveHistory() {\n            try {\n                localStorage.setItem('lorel_axun_history', JSON.stringify(history));\n            } catch (e) {\n                console.error(\"Failed to save history:\", e);\n            }\n        }\n\n        function loadHistory() {\n            try {\n                const savedHistory = localStorage.getItem('lorel_axun_history');\n                if (savedHistory) {\n                    history = JSON.parse(savedHistory);\n                    history.forEach(item => {\n                        term.writeln(`> ${item.command}`);\n                        term.writeln(item.response);\n                    });\n                }\n            } catch (e) {\n                console.error(\"Failed to load history:\", e);\n                history = [];\n            }\n        }\n\n        function processCommand() {\n            isLocked = true;\n            const input = command.trim();\n            term.writeln(''); // Move to the next line after user input\n\n            if (input.length > 0) {\n                const response = getAIResponse(input);\n                history.push({ command: input, response: response });\n                saveHistory();\n                if (response) {\n                    typewriterEffect(response, () => {\n                        isLocked = false;\n                        prompt();\n                    });\n                } else {\n                    isLocked = false;\n                    prompt();\n                }\n            } else {\n                isLocked = false;\n                prompt();\n            }\n        }\n\n        function prompt() {\n            command = '';\n            term.write(promptChar);\n        }\n\n        term.onKey(({ key, domEvent }) => {\n            if (isLocked) return;\n\n            const printable = !domEvent.altKey && !domEvent.ctrlKey && !domEvent.metaKey;\n\n            if (domEvent.keyCode === 13) { // Enter\n                processCommand();\n            } else if (domEvent.keyCode === 8) { // Backspace\n                if (command.length > 0) {\n                    term.write('\\b \\b');\n                    command = command.slice(0, -1);\n                }\n            } else if (printable) {\n                command += key;\n                term.write(key);\n            }\n        });\n\n        function showWelcomeMessage() {\n            figlet.text('Lorel Axun', {\n                font: 'Standard',\n                horizontalLayout: 'default',\n                verticalLayout: 'default'\n            }, function(err, data) {\n                if (err) {\n                    console.log('Something went wrong...');\n                    console.dir(err);\n                    return;\n                }\n                term.writeln(data);\n                loadHistory();\n                const welcomeText = 'Benvenuto. Sono Lorel Axun. Digita \\'help\\' per iniziare.';\n                typewriterEffect(welcomeText, () => {\n                    isLocked = false;\n                    prompt();\n                });\n            });\n        }\n\n        showWelcomeMessage();\n\n    </script>\n</body>\n</html>