<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Lorel Axun</title>\n    <link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/xterm/css/xterm.css\" />\n    <script src=\"https://cdn.jsdelivr.net/npm/xterm/lib/xterm.js\"></script>\n    <script src=\"https://cdn.jsdelivr.net/npm/xterm-addon-fit/lib/xterm-addon-fit.js\"></script>\n    <script src=\"https://cdn.jsdelivr.net/npm/xterm-addon-attach/lib/xterm-addon-attach.js\"></script>\n    <script src=\"https://cdn.jsdelivr.net/npm/figlet/lib/figlet.js\"></script>\n    <style>\n        :root {\n            --bg: #1a1b26;\n            --fg: #a9b1d6;\n            --black: #32344a;\n            --red: #f7768e;\n            --green: #9ece6a;\n            --yellow: #e0af68;\n            --blue: #7aa2f7;\n            --magenta: #bb9af7;\n            --cyan: #7dcfff;\n            --white: #c0caf5;\n        }\n        body, html {\n            margin: 0;\n            padding: 0;\n            height: 100%;\n            background-color: var(--bg);\n            color: var(--fg);\n            font-family: 'Menlo', 'Consolas', 'monospace';\n            overflow: hidden;\n        }\n        #terminal-container {\n            width: 100%;\n            height: 100%;\n            padding: 10px;\n            box-sizing: border-box;\n        }\n        .xterm .xterm-viewport {\n            background-color: var(--bg);\n        }\n        #desktop {\n            display: none;\n            width: 100vw;\n            height: 100vh;\n            background-size: cover;\n            background-position: center;\n            position: relative;\n        }\n        #dock {\n            position: absolute;\n            bottom: 20px;\n            left: 50%;\n            transform: translateX(-50%);\n            background-color: rgba(50, 52, 74, 0.8);\n            padding: 10px;\n            border-radius: 15px;\n            display: flex;\n            gap: 15px;\n        }\n        #terminal-icon {\n            width: 60px;\n            height: 60px;\n            background-color: var(--black);\n            border-radius: 10px;\n            cursor: pointer;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 24px;\n        }\n        #editor {\n            display: none;\n            position: fixed;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            background-color: var(--bg);\n            z-index: 100;\n            display: none;\n            flex-direction: column;\n        }\n        #editor-textarea {\n            flex-grow: 1;\n            background-color: var(--bg);\n            color: var(--fg);\n            border: none;\n            outline: none;\n            font-family: 'Menlo', 'Consolas', 'monospace';\n            font-size: 16px;\n            padding: 15px;\n            resize: none;\n        }\n        #editor-status {\n            background-color: var(--blue);\n            color: var(--bg);\n            padding: 5px 10px;\n            font-size: 14px;\n        }\n    </style>\n</head>\n<body>\n    <div id=\"terminal-container\"></div>\n    <div id=\"desktop\">\n        <div id=\"dock\">\n            <div id=\"terminal-icon\" title=\"Open Terminal\">&gt;_</div>\n        </div>\n    </div>\n    <div id=\"editor\">\n        <div id=\"editor-status\">File: <span id=\"editor-filename\"></span> | Ctrl+S to Save | Ctrl+Q to Quit</div>\n        <textarea id=\"editor-textarea\"></textarea>\n    </div>\n\n    <script>\n        const termContainer = document.getElementById('terminal-container');\n        const term = new Terminal({\n            cursorBlink: true,\n            theme: {\n                background: '#1a1b26',\n                foreground: '#a9b1d6',\n                black: '#32344a',\n                red: '#f7768e',\n                green: '#9ece6a',\n                yellow: '#e0af68',\n                blue: '#7aa2f7',\n                magenta: '#bb9af7',\n                cyan: '#7dcfff',\n                white: '#c0caf5',\n            }\n        });\n        const fitAddon = new FitAddon.FitAddon();\n        term.loadAddon(fitAddon);\n        term.open(termContainer);\n        fitAddon.fit();\n        window.addEventListener('resize', () => fitAddon.fit());\n\n        let vfs = JSON.parse(localStorage.getItem('lorel_vfs')) || {\n            '/': {\n                type: 'directory',\n                children: {\n                    'home': { type: 'directory', children: {} },\n                    'etc': { type: 'directory', children: {} },\n                    'bin': { type: 'directory', children: {} },\n                }\n            }\n        };\n        let env = JSON.parse(localStorage.getItem('lorel_env')) || {\n            'USER': 'utente',\n            'HOSTNAME': 'lorel-os',\n            'PWD': '/',\n            'HOME': '/home'\n        };\n        let currentPath = env.PWD;\n        let commandHistory = [];\n        let historyIndex = -1;\n        let currentCommand = '';\n        let webSocket = null;\n\n        function saveState() {\n            localStorage.setItem('lorel_vfs', JSON.stringify(vfs));\n            localStorage.setItem('lorel_env', JSON.stringify(env));\n        }\n\n        function getPrompt() {\n            return `\\x1b[32m${env.USER}@${env.HOSTNAME}\\x1b[0m:\\x1b[34m${currentPath}\\x1b[0m$ `;
        }\n\n        function writePrompt() {\n            currentCommand = '';\n            term.write('\\r\\n' + getPrompt());\n        }\n\n        figlet.parseFont('Standard', figlet.fonts.Standard);\n        figlet.text('Lorel Axun', { font: 'Standard' }, (err, data) => {\n            if (data) {\n                term.writeln(data.replace(/\\n/g, '\\r\\n'));\n            }\n            term.writeln('Welcome to Lorel OS. Type \"help\" for a list of commands.');\n            writePrompt();\n        });\n        \n        async function executeCommand(command) {\n            const [cmd, ...args] = command.trim().split(' ');\n            \n            if (cmd === 'connect') {\n                const url = args[0];\n                if (!url) {\n                    term.writeln('Usage: connect <ws_url>');\n                    return;\n                }\n                if (webSocket) {\n                    term.writeln('Already connected. Disconnect first.');\n                    return;\n                }\n                term.writeln(`Connecting to ${url}...`);\n                try {\n                    webSocket = new WebSocket(url);\n                    const attachAddon = new AttachAddon.AttachAddon(webSocket);\n                    term.loadAddon(attachAddon);\n                    \n                    webSocket.onclose = () => {\n                        term.writeln('\\r\\nConnection closed.');\n                        webSocket = null; \n                    };\n                    webSocket.onerror = (err) => {\n                        term.writeln(`\\r\\nConnection error.`);\n                        webSocket = null;\n                    };\n                } catch (e) {\n                    term.writeln(`Error: ${e.message}`);\n                    webSocket = null;\n                }\n            } else if (cmd === 'startx') {\n                document.getElementById('terminal-container').style.display = 'none';\n                const desktop = document.getElementById('desktop');\n                desktop.style.backgroundImage = `url('https://source.unsplash.com/random/1920x1080?technology,nature')`;\n                desktop.style.display = 'block';\n            } else {\n                 if (command.trim().length > 0) {\n                    term.writeln(`lorel: command not found: ${command}`);\n                 }\n            }\n        }\n\n        term.onKey(({ key, domEvent }) => {\n            if (webSocket && webSocket.readyState === WebSocket.OPEN) {\n                // If connected, the attach addon handles everything.\n                return;\n            }\n\n            const printable = !domEvent.altKey && !domEvent.ctrlKey && !domEvent.metaKey;\n\n            if (domEvent.keyCode === 13) { // Enter\n                term.write('\\r\\n');\n                executeCommand(currentCommand).then(writePrompt);\n                if (currentCommand) commandHistory.unshift(currentCommand);\n                historyIndex = -1;\n            } else if (domEvent.keyCode === 8) { // Backspace\n                if (currentCommand.length > 0) {\n                    term.write('\\b \\b');\n                    currentCommand = currentCommand.slice(0, -1);\n                }\n            } else if (printable) {\n                currentCommand += key;\n                term.write(key);\n            }\n        });\n        \n        document.getElementById('terminal-icon').addEventListener('click', () => {\n            document.getElementById('desktop').style.display = 'none';\n            document.getElementById('terminal-container').style.display = 'block';\n            term.focus();\n        });\n\n    </script>\n</body>\n</html>