<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lorel Axun</title>
    <style>
        :root {
            --background-color-dark: #121212;
            --text-color-dark: #E0E0E0;
            --header-bg-dark: #1E1E1E;
            --button-bg-dark: #333;
            --button-hover-bg-dark: #555;
            --terminal-bg-dark: rgba(0, 0, 0, 0.7);
            --terminal-text-dark: #00FF41;
            --particle-color-dark: "#ffffff";

            --background-color-light: #F0F0F0;
            --text-color-light: #121212;
            --header-bg-light: #FFFFFF;
            --button-bg-light: #E0E0E0;
            --button-hover-bg-light: #BDBDBD;
            --terminal-bg-light: rgba(255, 255, 255, 0.7);
            --terminal-text-light: #008000;
            --particle-color-light: "#000000";
        }

        html[data-theme='dark'] {
            --background-color: var(--background-color-dark);
            --text-color: var(--text-color-dark);
            --header-bg: var(--header-bg-dark);
            --button-bg: var(--button-bg-dark);
            --button-hover-bg: var(--button-hover-bg-dark);
            --terminal-bg: var(--terminal-bg-dark);
            --terminal-text: var(--terminal-text-dark);
            --particle-color: var(--particle-color-dark);
        }

        html[data-theme='light'] {
            --background-color: var(--background-color-light);
            --text-color: var(--text-color-light);
            --header-bg: var(--header-bg-light);
            --button-bg: var(--button-bg-light);
            --button-hover-bg: var(--button-hover-bg-light);
            --terminal-bg: var(--terminal-bg-light);
            --terminal-text: var(--terminal-text-light);
            --particle-color: var(--particle-color-light);
        }

        body {
            margin: 0;
            font-family: 'Courier New', Courier, monospace;
            background-color: var(--background-color);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
            transition: background-color 0.3s, color 0.3s;
        }

        #tsparticles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            background-color: var(--header-bg);
            border-bottom: 1px solid var(--text-color);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .header h1 {
            margin: 0;
            font-size: 1.5em;
        }

        #theme-toggle-button {
            padding: 8px 12px;
            background-color: var(--button-bg);
            color: var(--text-color);
            border: 1px solid var(--text-color);
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        #theme-toggle-button:hover {
            background-color: var(--button-hover-bg);
        }

        #terminal {
            flex-grow: 1;
            --background: var(--terminal-bg);
            --color: var(--terminal-text);
            --font-size: 1.2rem;
        }
    </style>
</head>
<body>
    <div id="tsparticles"></div>
    <div class="header">
        <h1>Lorel Axun</h1>
        <button id="theme-toggle-button">Toggle Theme</button>
    </div>
    <div id="terminal"></div>

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery.terminal@2.39.4/js/jquery.terminal.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jquery.terminal@2.39.4/css/jquery.terminal.min.css"/>
    <script src="https://cdn.jsdelivr.net/npm/@tsparticles/jquery@3.3.0/tsparticles.jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sentiment/sentiment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/node-nlp@4.27.0/lib/nlp.min.js"></script>

    <script>
        $(function() {
            const { NlpManager } = nlp;
            const manager = new NlpManager({ languages: ['en'], forceNER: true });
            const sentiment = new Sentiment();

            async function trainNlp() {
                // Greetings
                manager.addDocument('en', 'hello', 'greetings.hello');
                manager.addDocument('en', 'hi', 'greetings.hello');
                manager.addDocument('en', 'hey', 'greetings.hello');
                manager.addDocument('en', 'good morning', 'greetings.hello');
                manager.addDocument('en', 'good afternoon', 'greetings.hello');

                manager.addDocument('en', 'bye', 'greetings.bye');
                manager.addDocument('en', 'goodbye', 'greetings.bye');
                manager.addDocument('en', 'see you later', 'greetings.bye');

                // Agent Info
                manager.addDocument('en', 'who are you', 'agent.name');
                manager.addDocument('en', 'what is your name', 'agent.name');
                manager.addDocument('en', 'who created you', 'agent.creator');
                manager.addDocument('en', 'what can you do', 'agent.capabilities');
                manager.addDocument('en', 'help', 'agent.capabilities');

                // Answers
                manager.addAnswer('en', 'greetings.hello', 'Hello there!');
                manager.addAnswer('en', 'greetings.hello', 'Greetings!');
                manager.addAnswer('en', 'greetings.bye', 'Goodbye! Have a great day.');
                manager.addAnswer('en', 'greetings.bye', 'See you next time.');
                manager.addAnswer('en', 'agent.name', 'I am Lorel Axun, an evolving digital entity.');
                manager.addAnswer('en', 'agent.creator', 'I was created by AleXsjsju.');
                manager.addAnswer('en', 'agent.capabilities', 'I can understand conversations and execute commands. Try `wiki <search_term>` or `sentiment <phrase>`.');

                await manager.train();
                manager.save();
                return Promise.resolve();
            }

            const commands = {
                help: function() {
                    this.echo('Available commands:');
                    this.echo('  [[b;white;]wiki <search_term>]    - Search Wikipedia.');
                    this.echo('  [[b;white;]sentiment <phrase>]   - Analyze the sentiment of a phrase.');
                    this.echo('  [[b;white;]clear]                - Clear the terminal screen.');
                    this.echo('You can also talk to me naturally. Try asking `who are you?`');
                },
                wiki: async function(term) {
                    if (!term) {
                        this.error('Usage: wiki <search_term>');
                        return;
                    }
                    this.pause();
                    try {
                        const response = await fetch(`https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(term)}`);
                        if (!response.ok) throw new Error(`Wikipedia API error: ${response.statusText}`);
                        const data = await response.json();
                        const html = marked.parse(data.extract_html || 'No content found.');
                        this.echo(html, { raw: true });
                    } catch (error) {
                        this.error(`Error fetching from Wikipedia: ${error.message}`);
                    } finally {
                        this.resume();
                    }
                },
                sentiment: function(phrase) {
                    if (!phrase) {
                        this.error('Usage: sentiment <phrase>');
                        return;
                    }
                    const result = sentiment.analyze(phrase);
                    this.echo(`Sentiment Score: ${result.score}`);
                    this.echo(`Comparative: ${result.comparative.toFixed(2)}`);
                    if (result.positive.length > 0) this.echo(`Positive words: ${result.positive.join(', ')}`);
                    if (result.negative.length > 0) this.echo(`Negative words: ${result.negative.join(', ')}`);
                }
            };

            const term = $('#terminal').terminal(async (input, term) => {
                if (input.trim() === '') return;

                const nlpResult = await manager.process('en', input.trim());
                
                if (nlpResult.intent && nlpResult.score > 0.7 && nlpResult.answer) {
                    term.echo(nlpResult.answer);
                } else {
                    // Fallback to command parser if no intent is found
                    const parts = $.terminal.parse_command(input);
                    const command = commands[parts.name];
                    if (command) {
                        command.apply(term, parts.args);
                    } else {
                        term.error(`Unknown command: ${parts.name}. Try 'help' for a list of commands.`);
                    }
                }
            }, {
                greetings: 'Initializing Lorel Axun...\nTraining NLP model, please wait...',
                prompt: 'LA> ',
                onInit: function() {
                    trainNlp().then(() => {
                        this.set_prompt('LA> ');
                        this.echo('[[b;green;]Ready] I can now understand natural language. Ask me something or type `help` for a list of commands.');
                    });
                }
            });

            // --- Theme and Particles Management ---
            const particleOptions = {
                dark: { particles: { color: { value: "#ffffff" }, links: { color: "#ffffff" } } },
                light: { particles: { color: { value: "#000000" }, links: { color: "#000000" } } }
            };

            function applyTheme(theme) {
                $('html').attr('data-theme', theme);
                localStorage.setItem('theme', theme);
                term.set_prompt(theme === 'dark' ? '[[b;#00FF41;]LA>] ' : '[[b;#008000;]LA>] ');
                if (window.tsParticles) {
                    $('#tsparticles').tsparticles('load', particleOptions[theme]);
                }
            }

            $('#tsparticles').tsparticles({
                fpsLimit: 60,
                interactivity: {
                    events: { onHover: { enable: true, mode: "repulse" }, resize: true },
                    modes: { repulse: { distance: 100, duration: 0.4 } }
                },
                particles: {
                    number: { value: 80, density: { enable: true, value_area: 800 } },
                    move: { enable: true, speed: 2, direction: "none", random: false, straight: false, out_mode: "out", bounce: false },
                    links: { enable: true, distance: 150, opacity: 0.5, width: 1 },
                },
                detectRetina: true,
            });

            const savedTheme = localStorage.getItem('theme') || 'dark';
            applyTheme(savedTheme);

            $('#theme-toggle-button').on('click', () => {
                const currentTheme = $('html').attr('data-theme');
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                applyTheme(newTheme);
            });
        });
    </script>
</body>
</html>