<!DOCTYPE html>\n<html lang=\"it\" data-theme=\"dark\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Lorel Axun</title>\n    <style>\n        :root {\n            --light-bg: #f0f2f5;\n            --light-text: #1c1e21;\n            --light-header-bg: #ffffff;\n            --light-input-bg: #ffffff;\n            --light-bubble-ai-bg: #e4e6eb;\n            --light-bubble-user-bg: #0084ff;\n            --light-bubble-user-text: #ffffff;\n            --light-button-bg: #007bff;\n            --light-button-text: #ffffff;\n            --light-border-color: #ced4da;\n            --light-code-bg: #e9e9e9;\n            --light-code-text: #333;\n            --light-copy-button-bg: #d1d1d1;\n\n            --dark-bg: #18191a;\n            --dark-text: #e4e6eb;\n            --dark-header-bg: #242526;\n            --dark-input-bg: #3a3b3c;\n            --dark-bubble-ai-bg: #3a3b3c;\n            --dark-bubble-user-bg: #0084ff;\n            --dark-bubble-user-text: #ffffff;\n            --dark-button-bg: #007bff;\n            --dark-button-text: #ffffff;\n            --dark-border-color: #4b4c4d;\n            --dark-code-bg: #2d2d2d;\n            --dark-code-text: #f2f2f2;\n            --dark-copy-button-bg: #444;\n        }\n\n        html[data-theme='light'] {\n            --bg-color: var(--light-bg);\n            --text-color: var(--light-text);\n            --header-bg-color: var(--light-header-bg);\n            --input-bg-color: var(--light-input-bg);\n            --bubble-ai-bg-color: var(--light-bubble-ai-bg);\n            --bubble-user-bg-color: var(--light-bubble-user-bg);\n            --bubble-user-text-color: var(--light-bubble-user-text);\n            --button-bg-color: var(--light-button-bg);\n            --button-text-color: var(--light-button-text);\n            --border-color: var(--light-border-color);\n            --code-bg: var(--light-code-bg);\n            --code-text: var(--light-code-text);\n            --copy-button-bg: var(--light-copy-button-bg);\n        }\n\n        html[data-theme='dark'] {\n            --bg-color: var(--dark-bg);\n            --text-color: var(--dark-text);\n            --header-bg-color: var(--dark-header-bg);\n            --input-bg-color: var(--dark-input-bg);\n            --bubble-ai-bg-color: var(--dark-bubble-ai-bg);\n            --bubble-user-bg-color: var(--dark-bubble-user-bg);\n            --bubble-user-text-color: var(--dark-bubble-user-text);\n            --button-bg-color: var(--dark-button-bg);\n            --button-text-color: var(--dark-button-text);\n            --border-color: var(--dark-border-color);\n            --code-bg: var(--dark-code-bg);\n            --code-text: var(--dark-code-text);\n            --copy-button-bg: var(--dark-copy-button-bg);\n        }\n\n        @keyframes gradient {\n            0% { background-position: 0% 50%; }\n            50% { background-position: 100% 50%; }\n            100% { background-position: 0% 50%; }\n        }\n\n        body {\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;\n            margin: 0;\n            background-color: var(--bg-color);\n            color: var(--text-color);\n            display: flex;\n            flex-direction: column;\n            height: 100vh;\n            overflow: hidden;\n            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);\n            background-size: 400% 400%;\n            animation: gradient 15s ease infinite;\n            transition: background-color 0.3s ease;\n        }\n\n        #tsparticles {\n            position: fixed;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            z-index: 0;\n        }\n\n        .chat-container {\n            display: flex;\n            flex-direction: column;\n            max-width: 800px;\n            width: 100%;\n            height: 100%;\n            margin: 0 auto;\n            box-shadow: 0 0 20px rgba(0,0,0,0.1);\n            background-color: transparent;\n            position: relative;\n            z-index: 1;\n        }\n\n        .chat-header {\n            padding: 15px 20px;\n            background-color: var(--header-bg-color);\n            border-bottom: 1px solid var(--border-color);\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            backdrop-filter: blur(10px);\n            background-color: rgba(var(--header-bg-color-rgb), 0.8);\n        }\n\n        .chat-header h1 {\n            margin: 0;\n            font-size: 1.5em;\n        }\n\n        #theme-toggle-button {\n            background: none;\n            border: 1px solid var(--border-color);\n            color: var(--text-color);\n            padding: 8px 12px;\n            border-radius: 5px;\n            cursor: pointer;\n        }\n\n        #chat-messages {\n            flex-grow: 1;\n            overflow-y: auto;\n            padding: 20px;\n            display: flex;\n            flex-direction: column;\n            gap: 15px;\n            background-color: rgba(var(--bg-color-rgb), 0.7);\n            backdrop-filter: blur(10px);\n        }\n\n        .message {\n            display: flex;\n            flex-direction: column;\n            max-width: 80%;\n        }\n\n        .bubble {\n            padding: 10px 15px;\n            border-radius: 18px;\n            line-height: 1.5;\n        }\n\n        .message.ai {\n            align-self: flex-start;\n        }\n        .message.ai .bubble {\n            background-color: var(--bubble-ai-bg-color);\n            color: var(--text-color);\n            border-bottom-left-radius: 4px;\n        }\n\n        .message.user {\n            align-self: flex-end;\n        }\n        .message.user .bubble {\n            background-color: var(--bubble-user-bg-color);\n            color: var(--bubble-user-text-color);\n            border-bottom-right-radius: 4px;\n        }\n\n        .chat-input {\n            display: flex;\n            padding: 15px;\n            border-top: 1px solid var(--border-color);\n            background-color: var(--header-bg-color);\n            backdrop-filter: blur(10px);\n            background-color: rgba(var(--header-bg-color-rgb), 0.8);\n        }\n\n        #user-input {\n            flex-grow: 1;\n            padding: 10px;\n            border: 1px solid var(--border-color);\n            border-radius: 20px;\n            resize: none;\n            font-family: inherit;\n            font-size: 1em;\n            background-color: var(--input-bg-color);\n            color: var(--text-color);\n            max-height: 100px;\n            overflow-y: auto;\n        }\n\n        #send-button {\n            margin-left: 10px;\n            padding: 10px 20px;\n            border: none;\n            background-color: var(--button-bg-color);\n            color: var(--button-text-color);\n            border-radius: 20px;\n            cursor: pointer;\n            font-size: 1em;\n        }\n\n        .typing-indicator {\n            display: flex;\n            align-items: center;\n            gap: 5px;\n        }\n\n        .typing-indicator span {\n            width: 8px;\n            height: 8px;\n            background-color: var(--text-color);\n            border-radius: 50%;\n            animation: bounce 1.4s infinite ease-in-out both;\n        }\n\n        .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }\n        .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }\n\n        @keyframes bounce {\n            0%, 80%, 100% { transform: scale(0); }\n            40% { transform: scale(1.0); }\n        }\n        \n        .typing-cursor {\n            display: inline-block;\n            width: 8px;\n            height: 1em;\n            background-color: var(--text-color);\n            animation: blink 1s step-end infinite;\n            vertical-align: bottom;\n        }\n\n        @keyframes blink {\n            from, to { background-color: transparent; }\n            50% { background-color: var(--text-color); }\n        }\n\n        pre {\n            background-color: var(--code-bg);\n            color: var(--code-text);\n            padding: 15px;\n            border-radius: 8px;\n            overflow-x: auto;\n            position: relative;\n        }\n\n        .copy-button {\n            position: absolute;\n            top: 10px;\n            right: 10px;\n            background-color: var(--copy-button-bg);\n            color: var(--text-color);\n            border: none;\n            padding: 5px 10px;\n            border-radius: 5px;\n            cursor: pointer;\n            opacity: 0;\n            transition: opacity 0.2s;\n        }\n\n        pre:hover .copy-button {\n            opacity: 1;\n        }\n\n    </style>\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark.min.css\">\n</head>\n<body>\n\n    <div id=\"tsparticles\"></div>\n\n    <div class=\"chat-container\">\n        <header class=\"chat-header\">\n            <h1>Lorel Axun</h1>\n            <button id=\"theme-toggle-button\">Cambia Tema</button>\n        </header>\n        <div id=\"chat-messages\" id=\"chat-messages\"></div>\n        <div class=\"chat-input\">\n            <textarea id=\"user-input\" placeholder=\"Scrivi un messaggio...\" rows=\"1\"></textarea>\n            <button id=\"send-button\">Invia</button>\n        </div>\n    </div>\n\n    <script src=\"https://cdn.jsdelivr.net/npm/marked/marked.min.js\"></script>\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js\"></script>\n    <script src=\"https://cdn.jsdelivr.net/npm/sentiment@5.0.2/lib/index.min.js\"></script>\n    <script src=\"https://cdn.jsdelivr.net/npm/tsparticles@2.9.3/tsparticles.bundle.min.js\"></script>\n\n    <script>\n        const chatMessages = document.getElementById('chat-messages');\n        const userInput = document.getElementById('user-input');\n        const sendButton = document.getElementById('send-button');\n        const themeToggleButton = document.getElementById('theme-toggle-button');\n        const sentiment = new Sentiment();\n\n        function hexToRgb(hex) {\n            let result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\n            return result ? `${parseInt(result[1], 16)}, ${parseInt(result[2], 16)}, ${parseInt(result[3], 16)}` : null;\n        }\n\n        function updateCssRgbVariables(theme) {\n            const style = getComputedStyle(document.documentElement);\n            const headerBg = style.getPropertyValue('--header-bg-color').trim();\n            const bodyBg = style.getPropertyValue('--bg-color').trim();\n            document.documentElement.style.setProperty('--header-bg-color-rgb', hexToRgb(headerBg));\n            document.documentElement.style.setProperty('--bg-color-rgb', hexToRgb(bodyBg));\n        }\n\n        function initParticles(theme) {\n            const particleColor = theme === 'light' ? '#000000' : '#ffffff';\n            const linkColor = theme === 'light' ? '#000000' : '#ffffff';\n\n            tsParticles.load('tsparticles', {\n                fpsLimit: 60,\n                interactivity: {\n                    events: {\n                        onHover: {\n                            enable: true,\n                            mode: 'repulse',\n                        },\n                        resize: true,\n                    },\n                    modes: {\n                        repulse: {\n                            distance: 100,\n                            duration: 0.4,\n                        },\n                    },\n                },\n                particles: {\n                    color: {\n                        value: particleColor,\n                    },\n                    links: {\n                        color: linkColor,\n                        distance: 150,\n                        enable: true,\n                        opacity: 0.5,\n                        width: 1,\n                    },\n                    collisions: {\n                        enable: true,\n                    },\n                    move: {\n                        direction: 'none',\n                        enable: true,\n                        outModes: {\n                            default: 'bounce',\n                        },\n                        random: false,\n                        speed: 2,\n                        straight: false,\n                    },\n                    number: {\n                        density: {\n                            enable: true,\n                            area: 800,\n                        },\n                        value: 80,\n                    },\n                    opacity: {\n                        value: 0.5,\n                    },\n                    shape: {\n                        type: 'circle',\n                    },\n                    size: {\n                        value: { min: 1, max: 5 },\n                    },\n                },\n                detectRetina: true,\n            });\n        }\n\n        function toggleTheme() {\n            const currentTheme = document.documentElement.getAttribute('data-theme');\n            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';\n            document.documentElement.setAttribute('data-theme', newTheme);\n            localStorage.setItem('theme', newTheme);\n            updateCssRgbVariables(newTheme);\n            initParticles(newTheme);\n        }\n\n        themeToggleButton.addEventListener('click', toggleTheme);\n\n        const savedTheme = localStorage.getItem('theme') || 'dark';\n        document.documentElement.setAttribute('data-theme', savedTheme);\n        updateCssRgbVariables(savedTheme);\n        initParticles(savedTheme);\n\n        function addMessage(content, sender) {\n            const messageDiv = document.createElement('div');\n            messageDiv.className = `message ${sender}`;
\n            const bubbleDiv = document.createElement('div');\n            bubbleDiv.className = 'bubble';\n            \n            if (sender === 'ai') {\n                bubbleDiv.innerHTML = marked.parse(content);\n                addCopyButtons(bubbleDiv);\n            } else {\n                bubbleDiv.textContent = content;\n            }\n\n            messageDiv.appendChild(bubbleDiv);\n            chatMessages.appendChild(messageDiv);\n            chatMessages.scrollTop = chatMessages.scrollHeight;\n            return bubbleDiv;\n        }\n\n        function typeMessage(element, text) {\n            let i = 0;\n            element.innerHTML = '';\n            const cursor = document.createElement('span');\n            cursor.className = 'typing-cursor';\n            element.appendChild(cursor);\n\n            function typing() {\n                if (i < text.length) {\n                    const char = text.charAt(i);\n                    element.insertBefore(document.createTextNode(char), cursor);\n                    i++;\n                    chatMessages.scrollTop = chatMessages.scrollHeight;\n                    setTimeout(typing, 20);\n                } else {\n                    element.removeChild(cursor);\n                    element.innerHTML = marked.parse(text);\n                    addCopyButtons(element);\n                    hljs.highlightAll();\n                }\n            }\n            typing();\n        }\n\n        function addTypingIndicator() {\n            const indicatorDiv = document.createElement('div');\n            indicatorDiv.className = 'message ai typing-indicator-container';\n            indicatorDiv.innerHTML = `\n                <div class=\"bubble\">\n                    <div class=\"typing-indicator\">\n                        <span></span>\n                        <span></span>\n                        <span></span>\n                    </div>\n                </div>\n            `;\n            chatMessages.appendChild(indicatorDiv);\n            chatMessages.scrollTop = chatMessages.scrollHeight;\n            return indicatorDiv;\n        }\n\n        function removeTypingIndicator() {\n            const indicator = document.querySelector('.typing-indicator-container');\n            if (indicator) {\n                indicator.remove();\n            }\n        }\n\n        function addCopyButtons(container) {\n            const codeBlocks = container.querySelectorAll('pre');\n            codeBlocks.forEach(block => {\n                const button = document.createElement('button');\n                button.className = 'copy-button';\n                button.textContent = 'Copia';\n                button.addEventListener('click', () => {\n                    const code = block.querySelector('code').innerText;\n                    navigator.clipboard.writeText(code).then(() => {\n                        button.textContent = 'Copiato!';\n                        setTimeout(() => { button.textContent = 'Copia'; }, 2000);\n                    });\n                });\n                block.appendChild(button);\n            });\n        }\n\n        function updateBackgroundColor(text) {\n            const result = sentiment.analyze(text);\n            const score = result.comparative;\n            let hue;\n            if (score > 0.1) { // Positive\n                hue = 120; // Green\n            } else if (score < -0.1) { // Negative\n                hue = 0; // Red\n            } else { // Neutral\n                hue = 200; // Blue\n            }\n            const newGradient = `linear-gradient(-45deg, hsl(${hue-30}, 80%, 60%), hsl(${hue}, 80%, 60%), hsl(${hue+30}, 80%, 60%), hsl(${hue+60}, 80%, 60%))`;\n            document.body.style.background = newGradient;\n            document.body.style.backgroundSize = '400% 400%';\n            document.body.style.animation = 'gradient 15s ease infinite';\n        }\n\n        async function getAiResponse(message) {\n            const indicator = addTypingIndicator();\n            await new Promise(resolve => setTimeout(resolve, 1000));\n\n            let responseText = \"Non capisco il comando. Prova con 'wiki: <termine>' o 'sentiment: <testo>'.\";\n\n            if (message.toLowerCase().startsWith('wiki:')) {\n                const term = message.substring(5).trim();\n                try {\n                    const response = await fetch(`https://it.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(term)}`);\n                    const data = await response.json();\n                    if (data.type === 'standard' && data.extract_html) {\n                        responseText = `**Riepilogo da Wikipedia per \"${data.title}\":**\\n\\n${data.extract_html}`;
                    } else {\n                        responseText = `Non ho trovato risultati per \"${term}\" su Wikipedia.`;\n                    }\n                } catch (error) {\n                    responseText = \"C'è stato un errore nel contattare l'API di Wikipedia.\";\n                }\n            } else if (message.toLowerCase().startsWith('sentiment:')) {\n                const textToAnalyze = message.substring(10).trim();\n                const result = sentiment.analyze(textToAnalyze);\n                responseText = `**Analisi del sentiment:**\\n- Punteggio: ${result.score}\\n- Comparativo: ${result.comparative.toFixed(2)}\\n- Parole positive: ${result.positive.join(', ') || 'Nessuna'}\\n- Parole negative: ${result.negative.join(', ') || 'Nessuna'}`;
            } else if (message.toLowerCase().startsWith('news:')) {\n                responseText = \"La funzione notizie non è ancora implementata.\";\n            }\n\n            removeTypingIndicator();\n            const aiBubble = addMessage('', 'ai');\n            typeMessage(aiBubble, responseText);\n            saveChatHistory();\n        }\n\n        function handleSend() {\n            const message = userInput.value.trim();\n            if (message) {\n                addMessage(message, 'user');\n                updateBackgroundColor(message);\n                userInput.value = '';\n                userInput.style.height = 'auto';\n                getAiResponse(message);\n                saveChatHistory();\n            }\n        }\n\n        sendButton.addEventListener('click', handleSend);\n        userInput.addEventListener('keydown', (e) => {\n            if (e.key === 'Enter' && !e.shiftKey) {\n                e.preventDefault();\n                handleSend();\n            }\n        });\n\n        userInput.addEventListener('input', () => {\n            userInput.style.height = 'auto';\n            userInput.style.height = (userInput.scrollHeight) + 'px';\n        });\n\n        function saveChatHistory() {\n            localStorage.setItem('chatHistory', chatMessages.innerHTML);\n        }\n\n        function loadChatHistory() {\n            const history = localStorage.getItem('chatHistory');\n            if (history) {\n                chatMessages.innerHTML = history;\n                addCopyButtons(chatMessages);\n                chatMessages.scrollTop = chatMessages.scrollHeight;\n            }\n        }\n\n        window.addEventListener('load', loadChatHistory);\n\n    </script>\n</body>\n</html>