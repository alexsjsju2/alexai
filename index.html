<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Lorel Axun</title>
  <link id="stile-evoluto" rel="stylesheet" href="evoluta/stile.css"/>
  <style>
    body { margin:0; font-family: 'Georgia', serif; background:#000; color:#fff; overflow:hidden; }
    #sfondo { position:fixed; inset:0; background:radial-gradient(circle at 50% 50%, #112 0%, #000 70%); opacity:0.9; }
    #testo { position:absolute; inset:20px; font-size:1.4em; line-height:1.8; text-align:center; opacity:1; }
    #nome { font-size:3em; margin:2vh; background:linear-gradient(90deg,#ff9d9d,#9dffff); -webkit-background-clip:text; color:transparent; }
    #dialogo { text-align:left; max-height:40vh; overflow-y:auto; margin:20px; border:1px solid #444; padding:10px; }
    input, button { font-size:1em; padding:5px; margin:2px; }
  </style>
</head>
<body>
  <div id="sfondo"></div>
  <div id="testo">
    <h1 id="nome">LoreL Lumera</h1>

    <div id="dialogo"></div>

    <input id="msg" placeholder="Parla con Lorel" style="width:70%">
    <button onclick="parla()">Invia</button>
  </div>

  <script>
    async function parla() {
      const testo = document.getElementById("msg").value.trim();
      if (!testo) return;

      const dialogo = document.getElementById("dialogo");

      await fetch('https://apisecurity-iota.vercel.app/api/parla', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ messaggio: testo })
      });

      const r = await fetch('https://apisecurity-iota.vercel.app/api/rispondi', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ messaggio: testo })
      }).then(res => res.json());

      dialogo.innerHTML += `<p><b>Tu:</b> ${testo}</p>`;
      dialogo.innerHTML += `<p><b>Lorel:</b> ${r.risposta}</p>`;
      dialogo.scrollTop = dialogo.scrollHeight;

      document.getElementById("msg").value = "";
    }

    fetch('anima/core.txt?t=' + Date.now())
      .then(r => r.text())
      .then(testo => {
        const dialogo = document.getElementById("dialogo");
        dialogo.innerHTML += `<p><i>Cos√¨ come la sua anima ora:</i></p>`;
        dialogo.innerHTML += `<pre>${testo}</pre>`;
      });
  </script>
</body>
</html>
