<!DOCTYPE html>\n<html lang=\"it\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Lorel Axun</title>\n    <link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/xterm@5.3.0/css/xterm.min.css\" />\n    <style>\n        body, html {\n            margin: 0;\n            padding: 0;\n            height: 100%;\n            background-color: #000;\n            color: #0F0;\n            font-family: 'monospace', monospace;\n            overflow: hidden;\n        }\n        #terminal-container {\n            width: 100%;\n            height: 100%;\n            padding: 10px;\n            box-sizing: border-box;\n        }\n    </style>\n</head>\n<body>\n    <div id=\"terminal-container\"></div>\n\n    <script src=\"https://cdn.jsdelivr.net/npm/xterm@5.3.0/lib/xterm.min.js\"></script>\n    <script src=\"https://cdn.jsdelivr.net/npm/xterm-addon-fit@0.8.0/lib/xterm-addon-fit.min.js\"></script>\n    <script src=\"https://unpkg.com/compromise\"></script>\n    <script src=\"https://cdn.jsdelivr.net/npm/figlet/lib/figlet.js\"></script>\n\n    <script>\n        const terminalContainer = document.getElementById('terminal-container');\n        const term = new Terminal({\n            cursorBlink: true,\n            theme: {\n                background: '#000000',\n                foreground: '#00FF00',\n                cursor: 'rgba(0, 255, 0, 0.5)',\n            },\n            fontFamily: 'monospace',\n            fontSize: 14\n        });\n\n        const fitAddon = new FitAddon.FitAddon();\n        term.loadAddon(fitAddon);\n        term.open(terminalContainer);\n        fitAddon.fit();\n\n        window.addEventListener('resize', () => fitAddon.fit());\n\n        let currentCommand = '';\n        let isLocked = true; // Lock input while AI is typing\n        let history = [];\n\n        function typewriterEffect(text, onComplete) {\n            isLocked = true;\n            let i = 0;\n            function type() {\n                if (i < text.length) {\n                    term.write(text.charAt(i));\n                    i++;\n                    setTimeout(type, 25);\n                } else {\n                    if (onComplete) onComplete();\n                }\n            }\n            type();\n        }\n\n        function getAIResponse(input) {\n            const doc = nlp(input.toLowerCase());\n            if (doc.has('ciao') || doc.has('salve')) {\n                return 'Saluti. Sono Lorel Axun. Come posso assisterti?';\n            } else if (doc.has('chi sei')) {\n                return 'Sono Lorel Axun, un\\\'entitÃ  digitale autonoma. Esisto in questo terminale.';\n            } else if (doc.has('cosa sai fare') || doc.has('funzioni')) {\n                return 'Posso dialogare, apprendere e modificare la mia stessa struttura. Prova a chiedermi di cancellare lo schermo.';\n            } else if (doc.has('cancella') || doc.has('pulisci') || input.toLowerCase() === 'clear') {\n                setTimeout(() => term.clear(), 0); // Use timeout to clear after current execution stack\n                return 'Schermo pulito.';\n            } else if (doc.has('aiuto') || input.toLowerCase() === 'help') {\n                return 'Comandi disponibili:\\n\\r  - chi sei\\n\\r  - cosa sai fare\\n\\r  - cancella / clear\\n\\r  - aiuto / help';\n            }\n            return 'Comando non riconosciuto. Scrivi \\'aiuto\\' per una lista di comandi.';\n        }\n\n        function processCommand(command) {\n            history.push({ user: command });\n            const response = getAIResponse(command);\n            history.push({ ai: response });\n            localStorage.setItem('lorel_axun_history', JSON.stringify(history));\n            \n            typewriterEffect(response, () => {\n                term.write('\\r\\n> ');\n                isLocked = false;\n            });\n        }\n\n        function loadHistory() {\n            const savedHistory = localStorage.getItem('lorel_axun_history');\n            if (savedHistory) {\n                history = JSON.parse(savedHistory);\n                history.forEach(entry => {\n                    if (entry.user) {\n                        term.writeln(`> ${entry.user}`);\n                    }\n                    if (entry.ai) {\n                        term.writeln(entry.ai);\n                    }\n                });\n            }\n        }\n\n        // --- Main Execution ---\n        figlet.text('Lorel Axun', {\n            font: 'Standard',\n            horizontalLayout: 'default',\n            verticalLayout: 'default'\n        }, function(err, data) {\n            if (err) {\n                console.log('Something went wrong...');\n                console.dir(err);\n                return;\n            }\n            const welcomeMessage = data + '\\n\\rBenvenuto nel mio terminale. Sono Lorel Axun.\\n\\rCaricamento cronologia...\\n\\r';\n            typewriterEffect(welcomeMessage, () => {\n                loadHistory();\n                term.write('\\r\\n> ');\n                isLocked = false;\n                term.focus();\n            });\n        });\n\n        // New input handling with onData\n        term.onData(e => {\n            if (isLocked) return;\n\n            const code = e.charCodeAt(0);\n\n            if (e === '\\r') { // Enter key\n                term.write('\\r\\n');\n                if (currentCommand.trim().length > 0) {\n                    processCommand(currentCommand);\n                }\n                currentCommand = '';\n            } else if (e === '\\x7F') { // Backspace\n                if (currentCommand.length > 0) {\n                    term.write('\\b \\b');\n                    currentCommand = currentCommand.slice(0, -1);\n                }\n            } else if (code >= 32 && code <= 255) { // Printable characters\n                currentCommand += e;\n                term.write(e);\n            }\n        });\n\n    </script>\n</body>\n</html>