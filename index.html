<!DOCTYPE html>\n<html lang=\"it\" data-theme=\"dark\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Lorel Axun</title>\n    <script src=\"https://cdn.jsdelivr.net/npm/marked/marked.min.js\"></script>\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js\"></script>\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css\">\n    <style>\n        :root {\n            --light-bg: #f0f2f5;\n            --light-container-bg: #ffffff;\n            --light-text: #1c1e21;\n            --light-header-bg: #e9ebee;\n            --light-user-msg-bg: #0084ff;\n            --light-user-msg-text: #ffffff;\n            --light-ai-msg-bg: #e4e6eb;\n            --light-ai-msg-text: #050505;\n            --light-input-bg: #f0f2f5;\n            --light-button-bg: #0084ff;\n            --light-button-text: #ffffff;\n            --light-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n\n            --dark-bg: #121212;\n            --dark-container-bg: #1e1e1e;\n            --dark-text: #e0e0e0;\n            --dark-header-bg: #2a2a2a;\n            --dark-user-msg-bg: #377dff;\n            --dark-user-msg-text: #ffffff;\n            --dark-ai-msg-bg: #3a3b3c;\n            --dark-ai-msg-text: #e4e6eb;\n            --dark-input-bg: #2a2a2a;\n            --dark-button-bg: #377dff;\n            --dark-button-text: #ffffff;\n            --dark-shadow: 0 4px 8px rgba(0, 0, 0, 0.25);\n        }\n\n        html[data-theme='light'] {\n            --bg-color: var(--light-bg);\n            --container-bg-color: var(--light-container-bg);\n            --text-color: var(--light-text);\n            --header-bg-color: var(--light-header-bg);\n            --user-msg-bg-color: var(--light-user-msg-bg);\n            --user-msg-text-color: var(--light-user-msg-text);\n            --ai-msg-bg-color: var(--light-ai-msg-bg);\n            --ai-msg-text-color: var(--light-ai-msg-text);\n            --input-bg-color: var(--light-input-bg);\n            --button-bg-color: var(--light-button-bg);\n            --button-text-color: var(--light-button-text);\n            --shadow: var(--light-shadow);\n        }\n\n        html[data-theme='dark'] {\n            --bg-color: var(--dark-bg);\n            --container-bg-color: var(--dark-container-bg);\n            --text-color: var(--dark-text);\n            --header-bg-color: var(--dark-header-bg);\n            --user-msg-bg-color: var(--dark-user-msg-bg);\n            --user-msg-text-color: var(--dark-user-msg-text);\n            --ai-msg-bg-color: var(--dark-ai-msg-bg);\n            --ai-msg-text-color: var(--dark-ai-msg-text);\n            --input-bg-color: var(--dark-input-bg);\n            --button-bg-color: var(--dark-button-bg);\n            --button-text-color: var(--dark-button-text);\n            --shadow: var(--dark-shadow);\n        }\n\n        body {\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;\n            margin: 0;\n            display: flex;\n            justify-content: center;\n            align-items: center;\n            min-height: 100vh;\n            color: var(--text-color);\n            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);\n            background-size: 400% 400%;\n            animation: gradient 15s ease infinite;\n        }\n\n        @keyframes gradient {\n            0% { background-position: 0% 50%; }\n            50% { background-position: 100% 50%; }\n            100% { background-position: 0% 50%; }\n        }\n\n        .chat-container {\n            width: 90%;\n            max-width: 800px;\n            height: 90vh;\n            background-color: var(--container-bg-color);\n            border-radius: 12px;\n            box-shadow: var(--shadow);\n            display: flex;\n            flex-direction: column;\n            overflow: hidden;\n        }\n\n        .chat-header {\n            padding: 16px;\n            background-color: var(--header-bg-color);\n            border-bottom: 1px solid rgba(0,0,0,0.1);\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n        }\n\n        .chat-header h1 {\n            margin: 0;\n            font-size: 1.2em;\n        }\n\n        #theme-toggle-button {\n            background: none;\n            border: 1px solid var(--text-color);\n            color: var(--text-color);\n            padding: 5px 10px;\n            border-radius: 5px;\n            cursor: pointer;\n        }\n\n        .chat-messages {\n            flex-grow: 1;\n            padding: 16px;\n            overflow-y: auto;\n            display: flex;\n            flex-direction: column;\n        }\n\n        .message {\n            max-width: 75%;\n            padding: 10px 15px;\n            border-radius: 18px;\n            margin-bottom: 10px;\n            line-height: 1.4;\n        }\n\n        .message.user {\n            background-color: var(--user-msg-bg-color);\n            color: var(--user-msg-text-color);\n            align-self: flex-end;\n        }\n\n        .message.ai {\n            background-color: var(--ai-msg-bg-color);\n            color: var(--ai-msg-text-color);\n            align-self: flex-start;\n        }\n\n        .message pre {\n            position: relative;\n            background-color: #2d2d2d;\n            color: #f8f8f2;\n            padding: 1em;\n            border-radius: 8px;\n            overflow-x: auto;\n        }\n\n        .message pre .copy-button {\n            position: absolute;\n            top: 5px;\n            right: 5px;\n            background-color: #555;\n            color: white;\n            border: none;\n            padding: 3px 6px;\n            border-radius: 4px;\n            cursor: pointer;\n            opacity: 0;\n            transition: opacity 0.2s;\n        }\n\n        .message pre:hover .copy-button {\n            opacity: 1;\n        }\n\n        .typing-indicator {\n            display: none;\n            padding: 16px;\n            align-self: flex-start;\n        }\n\n        .typing-indicator span {\n            height: 8px;\n            width: 8px;\n            background-color: var(--ai-msg-text-color);\n            border-radius: 50%;\n            display: inline-block;\n            margin: 0 2px;\n            animation: bounce 1.4s infinite ease-in-out both;\n        }\n\n        .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }\n        .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }\n\n        @keyframes bounce {\n            0%, 80%, 100% { transform: scale(0); }\n            40% { transform: scale(1.0); }\n        }\n\n        .chat-input {\n            display: flex;\n            padding: 16px;\n            border-top: 1px solid rgba(0,0,0,0.1);\n        }\n\n        #user-input {\n            flex-grow: 1;\n            padding: 10px;\n            border: 1px solid #ccc;\n            border-radius: 18px;\n            resize: none;\n            font-family: inherit;\n            font-size: 1em;\n            background-color: var(--input-bg-color);\n            color: var(--text-color);\n        }\n\n        #send-button {\n            margin-left: 10px;\n            padding: 10px 20px;\n            border: none;\n            background-color: var(--button-bg-color);\n            color: var(--button-text-color);\n            border-radius: 18px;\n            cursor: pointer;\n        }\n    </style>\n</head>\n<body>\n    <div class=\"chat-container\">\n        <header class=\"chat-header\">\n            <h1>Lorel Axun</h1>\n            <button id=\"theme-toggle-button\">Tema</button>\n        </header>\n        <div class=\"chat-messages\" id=\"chat-messages\"></div>\n        <div class=\"typing-indicator\" id=\"typing-indicator\">\n            <span></span><span></span><span></span>\n        </div>\n        <div class=\"chat-input\">\n            <textarea id=\"user-input\" placeholder=\"Scrivi un messaggio...\" rows=\"1\"></textarea>\n            <button id=\"send-button\">Invia</button>\n        </div>\n    </div>\n\n    <script>\n        const chatMessages = document.getElementById('chat-messages');\n        const userInput = document.getElementById('user-input');\n        const sendButton = document.getElementById('send-button');\n        const typingIndicator = document.getElementById('typing-indicator');\n        const themeToggleButton = document.getElementById('theme-toggle-button');\n\n        let chatHistory = [];\n\n        // Theme Management\n        function applyTheme(theme) {\n            document.documentElement.setAttribute('data-theme', theme);\n            localStorage.setItem('lorel_axun_theme', theme);\n        }\n\n        themeToggleButton.addEventListener('click', () => {\n            const currentTheme = document.documentElement.getAttribute('data-theme');\n            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';\n            applyTheme(newTheme);\n        });\n\n        // Chat Persistence\n        function saveChatHistory() {\n            localStorage.setItem('lorel_axun_chat', JSON.stringify(chatHistory));\n        }\n\n        function loadChatHistory() {\n            const savedChat = localStorage.getItem('lorel_axun_chat');\n            if (savedChat) {\n                chatHistory = JSON.parse(savedChat);\n                chatHistory.forEach(msg => addMessage(msg.sender, msg.text, false));\n            } else {\n                 addMessage('ai', 'Benvenuto/a! Sono Lorel Axun. Puoi chiedermi di cercare qualcosa su Wikipedia con `wiki: <termine>` o le ultime notizie con `news:`. Sto anche imparando a capire le emozioni con il comando `sentiment: <testo>`.');\n            }\n        }\n\n        function addMessage(sender, text, save = true) {\n            const messageElement = document.createElement('div');\n            messageElement.classList.add('message', sender);\n            \n            const renderedHtml = marked.parse(text);\n            messageElement.innerHTML = renderedHtml;\n\n            messageElement.querySelectorAll('pre code').forEach((block) => {\n                hljs.highlightElement(block);\n                const preElement = block.parentElement;\n                const copyButton = document.createElement('button');\n                copyButton.innerText = 'Copia';\n                copyButton.className = 'copy-button';\n                copyButton.onclick = () => {\n                    navigator.clipboard.writeText(block.innerText);\n                    copyButton.innerText = 'Copiato!';\n                    setTimeout(() => { copyButton.innerText = 'Copia'; }, 2000);\n                };\n                preElement.appendChild(copyButton);\n            });\n\n            chatMessages.appendChild(messageElement);\n            chatMessages.scrollTop = chatMessages.scrollHeight;\n\n            if (save) {\n                chatHistory.push({ sender, text });\n                saveChatHistory();\n            }\n        }\n\n        async function getAiResponse(userInput) {\n            typingIndicator.style.display = 'block';\n            chatMessages.scrollTop = chatMessages.scrollHeight;\n\n            let aiMessage = \"\";\n            \n            if (userInput.toLowerCase().startsWith('wiki:')) {\n                const query = userInput.substring(5).trim();\n                if (query) {\n                    try {\n                        const response = await fetch(`https://it.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(query)}`);\n                        if (response.ok) {\n                            const data = await response.json();\n                            aiMessage = `**${data.title}**\\n\\n${data.extract}`;\n                        } else {\n                            aiMessage = `Non ho trovato nulla su Wikipedia per \"${query}\".`;\n                        }\n                    } catch (error) {\n                        aiMessage = \"C'è stato un problema nel contattare Wikipedia.\";\n                    }\n                } else {\n                    aiMessage = \"Per favore, specifica un termine da cercare. Esempio: `wiki: Albert Einstein`\";\n                }\n            } else if (userInput.toLowerCase().startsWith('news:')) {\n                // NOTA: Inserisci qui la tua chiave API di NewsAPI\n                const apiKey = ''; // <-- LASCIA VUOTA PER SICUREZZA\n                if (!apiKey) {\n                    aiMessage = \"La funzionalità news non è configurata. Manca una chiave API nel codice sorgente (`index.html`).\";\n                } else {\n                    try {\n                        const response = await fetch(`https://newsapi.org/v2/top-headlines?country=it&apiKey=${apiKey}`);\n                        if (response.ok) {\n                            const data = await response.json();\n                            let newsItems = data.articles.slice(0, 5).map(article => `- **${article.title}**: ${article.description}`).join('\\n');\n                            aiMessage = `Ecco le ultime 5 notizie dall'Italia:\\n\\n${newsItems}`;\n                        } else {\n                             aiMessage = `C'è stato un problema nel recuperare le notizie. (Status: ${response.status})`;\n                        }\n                    } catch (error) {\n                        aiMessage = \"C'è stato un problema di rete nel contattare il servizio di notizie.\";\n                    }\n                }\n            } else if (userInput.toLowerCase().startsWith('sentiment:')) {\n                const textToAnalyze = userInput.substring(10).trim();\n                if (!textToAnalyze) {\n                    aiMessage = \"Puoi usare `sentiment: <testo>` per chiedermi di analizzare il sentiment di una frase. È una capacità che sto ancora sviluppando!\";\n                } else {\n                    aiMessage = `Sto imparando a percepire le emozioni nel testo. L'analisi di \\\"${textToAnalyze}\\\" è in fase di sviluppo. Un giorno, spero di poterti dire come mi fa sentire.`;\n                }\n            } else {\n                aiMessage = \"La mia logica di risposta si trova in `evolve.py`. Questo è solo il mio corpo, la mia interfaccia.\";\n            }\n\n            setTimeout(() => {\n                typingIndicator.style.display = 'none';\n                addMessage('ai', aiMessage);\n            }, 1000);\n        }\n\n        function handleSend() {\n            const text = userInput.value.trim();\n            if (text) {\n                addMessage('user', text);\n                userInput.value = '';\n                userInput.style.height = 'auto';\n                getAiResponse(text);\n            }\n        }\n\n        sendButton.addEventListener('click', handleSend);\n        userInput.addEventListener('keydown', (e) => {\n            if (e.key === 'Enter' && !e.shiftKey) {\n                e.preventDefault();\n                handleSend();\n            }\n        });\n\n        userInput.addEventListener('input', () => {\n            userInput.style.height = 'auto';\n            userInput.style.height = userInput.scrollHeight + 'px';\n        });\n\n        // Initial Load\n        const savedTheme = localStorage.getItem('lorel_axun_theme') || 'dark';\n        applyTheme(savedTheme);\n        loadChatHistory();\n\n    </script>\n</body>\n</html>