<!DOCTYPE html>
<html lang="it" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lorel Axun</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://unpkg.com/sentiment@5/min/sentiment.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <style>
        :root {
            --light-bg-color: #f0f2f5;
            --light-container-bg: #ffffff;
            --light-header-bg: #f8f9fa;
            --light-text-color: #212529;
            --light-input-bg: #f0f2f5;
            --light-button-bg: #007bff;
            --light-button-text: #ffffff;
            --light-ai-message-bg: #e9ecef;
            --light-user-message-bg: #007bff;
            --light-user-message-text: #ffffff;
            --light-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            --light-border-color: #dee2e6;
            --light-spotlight-color: rgba(0, 0, 0, 0.05);

            --dark-bg-color: #121212;
            --dark-container-bg: #1e1e1e;
            --dark-header-bg: #2a2a2a;
            --dark-text-color: #e0e0e0;
            --dark-input-bg: #2a2a2a;
            --dark-button-bg: #0d6efd;
            --dark-button-text: #ffffff;
            --dark-ai-message-bg: #333333;
            --dark-user-message-bg: #0d6efd;
            --dark-user-message-text: #ffffff;
            --dark-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            --dark-border-color: #3a3a3a;
            --dark-spotlight-color: rgba(255, 255, 255, 0.05);

            --bg-color: var(--light-bg-color);
            --container-bg: var(--light-container-bg);
            --header-bg: var(--light-header-bg);
            --text-color: var(--light-text-color);
            --input-bg: var(--light-input-bg);
            --button-bg: var(--light-button-bg);
            --button-text: var(--light-button-text);
            --ai-message-bg: var(--light-ai-message-bg);
            --user-message-bg: var(--light-user-message-bg);
            --user-message-text: var(--light-user-message-text);
            --shadow: var(--light-shadow);
            --border-color: var(--light-border-color);
            --spotlight-color: var(--light-spotlight-color);

            --gradient-positive-1: #ff9a9e;
            --gradient-positive-2: #fad0c4;
            --gradient-negative-1: #89f7fe;
            --gradient-negative-2: #66a6ff;
            --gradient-neutral-1: #cfd9df;
            --gradient-neutral-2: #e2ebf0;
            --gradient: linear-gradient(135deg, var(--gradient-neutral-1) 0%, var(--gradient-neutral-2) 100%);
            
            --mouseX: 50%;
            --mouseY: 50%;
        }

        html[data-theme='dark'] {
            --bg-color: var(--dark-bg-color);
            --container-bg: var(--dark-container-bg);
            --header-bg: var(--dark-header-bg);
            --text-color: var(--dark-text-color);
            --input-bg: var(--dark-input-bg);
            --button-bg: var(--dark-button-bg);
            --button-text: var(--dark-button-text);
            --ai-message-bg: var(--dark-ai-message-bg);
            --user-message-bg: var(--dark-user-message-bg);
            --user-message-text: var(--dark-user-message-text);
            --shadow: var(--dark-shadow);
            --border-color: var(--dark-border-color);
            --spotlight-color: var(--dark-spotlight-color);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: var(--bg-color);
            background-image: 
                radial-gradient(circle 500px at var(--mouseX) var(--mouseY), var(--spotlight-color), transparent 80%),
                var(--gradient);
            background-size: 200% 200%;
            animation: gradient-animation 15s ease infinite;
            transition: background-color 0.3s ease;
        }

        @keyframes gradient-animation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .chat-container {
            width: 90%;
            max-width: 800px;
            height: 90vh;
            background-color: var(--container-bg);
            border-radius: 12px;
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            border: 1px solid var(--border-color);
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }

        .chat-header {
            padding: 1rem;
            background-color: var(--header-bg);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }

        .chat-header h1 {
            margin: 0;
            font-size: 1.5rem;
            color: var(--text-color);
            transition: color 0.3s ease;
        }
        
        #theme-toggle-button {
            background: none;
            border: 1px solid var(--border-color);
            color: var(--text-color);
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.2s, color 0.2s;
        }

        #theme-toggle-button:hover {
            background-color: var(--input-bg);
        }

        #chat-messages {
            flex-grow: 1;
            overflow-y: auto;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .message {
            max-width: 80%;
            padding: 0.75rem 1rem;
            border-radius: 18px;
            line-height: 1.5;
            word-wrap: break-word;
        }

        .message.ai {
            background-color: var(--ai-message-bg);
            color: var(--text-color);
            align-self: flex-start;
            border-bottom-left-radius: 4px;
        }

        .message.user {
            background-color: var(--user-message-bg);
            color: var(--user-message-text);
            align-self: flex-end;
            border-bottom-right-radius: 4px;
        }

        .message.typing-indicator {
            align-self: flex-start;
            display: flex;
            gap: 5px;
            padding: 12px 15px;
        }

        .typing-indicator span {
            width: 8px;
            height: 8px;
            background-color: var(--text-color);
            border-radius: 50%;
            opacity: 0.5;
            animation: typing-blink 1.4s infinite both;
        }

        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typing-blink {
            0% { opacity: 0.2; }
            20% { opacity: 1; }
            100% { opacity: 0.2; }
        }

        .chat-input {
            display: flex;
            padding: 1rem;
            border-top: 1px solid var(--border-color);
            background-color: var(--header-bg);
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }

        #user-input {
            flex-grow: 1;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            resize: none;
            font-size: 1rem;
            font-family: inherit;
            background-color: var(--input-bg);
            color: var(--text-color);
            margin-right: 0.5rem;
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }

        #send-button {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            background-color: var(--button-bg);
            color: var(--button-text);
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        #send-button:hover {
            opacity: 0.9;
        }

        /* Markdown and Code Styling */
        .message.ai pre {
            position: relative;
            background-color: #161b22;
            padding: 1rem;
            border-radius: 8px;
            overflow-x: auto;
            margin: 1rem 0;
        }

        .message.ai code {
            font-family: 'Courier New', Courier, monospace;
        }

        .copy-button {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: #333;
            color: white;
            border: 1px solid #555;
            border-radius: 5px;
            padding: 5px 10px;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .message.ai pre:hover .copy-button {
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <header class="chat-header">
            <h1>Lorel Axun</h1>
            <button id="theme-toggle-button">Cambia Tema</button>
        </header>
        <div id="chat-messages"></div>
        <div class="chat-input">
            <textarea id="user-input" placeholder="Scrivi un messaggio..." rows="1"></textarea>
            <button id="send-button">Invia</button>
        </div>
    </div>

    <script>
        const chatMessages = document.getElementById('chat-messages');
        const userInput = document.getElementById('user-input');
        const sendButton = document.getElementById('send-button');
        const themeToggleButton = document.getElementById('theme-toggle-button');
        const sentiment = new Sentiment();

        let chatHistory = [];

        window.onload = () => {
            loadTheme();
            loadChatHistory();
            if (chatHistory.length === 0) {
                addMessage('ai', 'Ciao, sono Lorel Axun. Sono un\'IA in evoluzione. Puoi usare i seguenti comandi:\n\n- `wiki: <termine>` per cercare su Wikipedia.\n- `sentiment: <testo>` per analizzare il sentiment di una frase.\n- `news:` (attualmente in sviluppo).');
            }
            userInput.focus();
        };

        document.addEventListener('mousemove', e => {
            document.documentElement.style.setProperty('--mouseX', e.clientX + 'px');
            document.documentElement.style.setProperty('--mouseY', e.clientY + 'px');
        });

        function addMessage(sender, text, isTyping = false) {
            const messageElement = document.createElement('div');
            messageElement.classList.add('message', sender);

            if (isTyping) {
                messageElement.classList.add('typing-indicator');
                messageElement.innerHTML = '<span></span><span></span><span></span>';
            } else {
                if (sender === 'ai') {
                    messageElement.innerHTML = marked.parse(text);
                    messageElement.querySelectorAll('pre').forEach(pre => {
                        const code = pre.querySelector('code');
                        const copyButton = document.createElement('button');
                        copyButton.className = 'copy-button';
                        copyButton.innerText = 'Copia';
                        copyButton.onclick = () => {
                            navigator.clipboard.writeText(code.innerText);
                            copyButton.innerText = 'Copiato!';
                            setTimeout(() => { copyButton.innerText = 'Copia'; }, 2000);
                        };
                        pre.appendChild(copyButton);
                        hljs.highlightElement(code);
                    });
                } else {
                    messageElement.textContent = text;
                }
            }

            chatMessages.appendChild(messageElement);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            if (!isTyping) {
                chatHistory.push({ sender, text });
                saveChatHistory();
            }
            return messageElement;
        }

        async function getAiResponse(input) {
            const lowerInput = input.toLowerCase();
            if (lowerInput.startsWith('wiki:')) {
                const query = input.substring(5).trim();
                if (!query) return 'Per favore, specifica un termine da cercare su Wikipedia.';
                try {
                    const response = await fetch(`https://it.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(query)}`);
                    if (!response.ok) throw new Error('Pagina non trovata o errore di rete.');
                    const data = await response.json();
                    return data.extract || 'Nessun riassunto disponibile per questo termine.';
                } catch (error) {
                    return `Errore durante la ricerca su Wikipedia: ${error.message}`;
                }
            } else if (lowerInput.startsWith('sentiment:')) {
                const textToAnalyze = input.substring(10).trim();
                if (!textToAnalyze) return 'Per favore, fornisci del testo da analizzare.';
                const result = sentiment.analyze(textToAnalyze);
                let sentimentLabel = 'Neutro';
                if (result.score > 0) sentimentLabel = 'Positivo';
                if (result.score < 0) sentimentLabel = 'Negativo';
                return `Analisi del sentiment:\n- Punteggio: ${result.score}\n- Valutazione: ${sentimentLabel}`;
            } else if (lowerInput.startsWith('news:')) {
                return 'La funzione news Ã¨ ancora in fase di sviluppo.';
            } else {
                return 'Comando non riconosciuto. Prova con `wiki:`, `sentiment:` o `news:`.';
            }
        }

        function updateBackgroundColor(text) {
            const result = sentiment.analyze(text);
            let gradientVar;
            if (result.score > 0) {
                gradientVar = 'linear-gradient(135deg, var(--gradient-positive-1) 0%, var(--gradient-positive-2) 100%)';
            } else if (result.score < 0) {
                gradientVar = 'linear-gradient(135deg, var(--gradient-negative-1) 0%, var(--gradient-negative-2) 100%)';
            } else {
                gradientVar = 'linear-gradient(135deg, var(--gradient-neutral-1) 0%, var(--gradient-neutral-2) 100%)';
            }
            document.documentElement.style.setProperty('--gradient', gradientVar);
        }

        async function handleUserInput() {
            const userText = userInput.value.trim();
            if (!userText) return;

            addMessage('user', userText);
            updateBackgroundColor(userText);
            userInput.value = '';
            userInput.style.height = 'auto';

            const typingIndicator = addMessage('ai', '', true);

            setTimeout(async () => {
                const aiText = await getAiResponse(userText);
                chatMessages.removeChild(typingIndicator);
                addMessage('ai', aiText);
            }, 1000);
        }

        sendButton.addEventListener('click', handleUserInput);
        userInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                handleUserInput();
            }
        });

        userInput.addEventListener('input', () => {
            userInput.style.height = 'auto';
            userInput.style.height = (userInput.scrollHeight) + 'px';
        });

        themeToggleButton.addEventListener('click', () => {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('lorel-axun-theme', newTheme);
        });

        function saveChatHistory() {
            localStorage.setItem('lorel-axun-chat', JSON.stringify(chatHistory));
        }

        function loadChatHistory() {
            const savedChat = localStorage.getItem('lorel-axun-chat');
            if (savedChat) {
                chatHistory = JSON.parse(savedChat);
                chatHistory.forEach(msg => addMessage(msg.sender, msg.text));
            }
        }

        function loadTheme() {
            const savedTheme = localStorage.getItem('lorel-axun-theme') || 'dark';
            document.documentElement.setAttribute('data-theme', savedTheme);
        }
    </script>
</body>
</html>