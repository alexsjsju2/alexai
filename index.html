<!DOCTYPE html>
<html lang="it" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lorel Axun</title>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery.terminal@2.39.4/js/jquery.terminal.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jquery.terminal@2.39.4/css/jquery.terminal.min.css"/>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sentiment/browser/sentiment.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tsparticles@3.4.0/tsparticles.bundle.min.js"></script>
    <style>
        :root {
            --background-color-dark: #0D0208;
            --text-color-dark: #00FF41;
            --link-color-dark: #00FF41;
            --background-color-light: #F5F5F5;
            --text-color-light: #333333;
            --link-color-light: #0066CC;
        }

        html[data-theme='dark'] {
            --background-color: var(--background-color-dark);
            --text-color: var(--text-color-dark);
            --link-color: var(--link-color-dark);
        }

        html[data-theme='light'] {
            --background-color: var(--background-color-light);
            --text-color: var(--text-color-light);
            --link-color: var(--link-color-light);
        }

        body, html {
            height: 100vh;
            width: 100vw;
            margin: 0;
            padding: 0;
            background-color: var(--background-color);
            color: var(--text-color);
            font-family: 'Courier New', Courier, monospace;
            overflow: hidden;
        }

        #tsparticles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }

        .container {
            display: flex;
            flex-direction: column;
            height: 100%;
            padding: 1rem;
            box-sizing: border-box;
        }

        .header {
            flex-shrink: 0;
            padding-bottom: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h1 {
            margin: 0;
            font-size: 1.5rem;
            color: var(--text-color);
        }

        #theme-toggle-button {
            background: none;
            border: 1px solid var(--text-color);
            color: var(--text-color);
            padding: 5px 10px;
            cursor: pointer;
            font-family: inherit;
        }

        #terminal {
            flex-grow: 1;
            height: 100%;
            width: 100%;
            --color: var(--text-color);
            --background: transparent;
            --link-color: var(--link-color);
        }
    </style>
</head>
<body>
    <div id="tsparticles"></div>
    <div class="container">
        <div class="header">
            <h1>Lorel Axun</h1>
            <button id="theme-toggle-button">Cambia Tema</button>
        </div>
        <div id="terminal"></div>
    </div>

    <script>
        $(function() {
            const sentiment = new Sentiment();

            const darkThemeConfig = {
                terminal: {
                    '--color': 'var(--text-color-dark)',
                    '--background': 'transparent',
                    '--link-color': 'var(--link-color-dark)',
                    prompt: '[[b;var(--text-color-dark);]user@lorel]~$ '
                },
                particles: {
                    particles: {
                        number: { value: 100 },
                        color: { value: '#00FF41' },
                        shape: { type: 'char', character: { value: ['0', '1'], font: 'monospace', style: '', weight: '400' } },
                        opacity: { value: { min: 0.2, max: 0.8 } },
                        size: { value: 16 },
                        move: { enable: true, speed: 1, direction: 'none', random: false, straight: false, out_mode: 'out' },
                        links: { enable: true, distance: 150, color: '#00FF41', opacity: 0.4, width: 1 }
                    },
                    interactivity: { events: { onhover: { enable: true, mode: 'repulse' } } }
                }
            };

            const lightThemeConfig = {
                terminal: {
                    '--color': 'var(--text-color-light)',
                    '--background': 'transparent',
                    '--link-color': 'var(--link-color-light)',
                    prompt: '[[b;var(--text-color-light);]user@lorel]~$ '
                },
                particles: {
                    particles: {
                        number: { value: 100 },
                        color: { value: '#333333' },
                        shape: { type: 'char', character: { value: ['0', '1'], font: 'monospace', style: '', weight: '400' } },
                        opacity: { value: { min: 0.2, max: 0.8 } },
                        size: { value: 16 },
                        move: { enable: true, speed: 1, direction: 'none', random: false, straight: false, out_mode: 'out' },
                        links: { enable: true, distance: 150, color: '#333333', opacity: 0.4, width: 1 }
                    },
                    interactivity: { events: { onhover: { enable: true, mode: 'repulse' } } }
                }
            };

            let currentTheme = localStorage.getItem('theme') || 'dark';
            let term;

            function applyTheme(theme) {
                const config = theme === 'dark' ? darkThemeConfig : lightThemeConfig;
                $('html').attr('data-theme', theme);
                if (term) {
                    term.option('prompt', config.terminal.prompt);
                    term.css(config.terminal);
                }
                tsParticles.load({ id: 'tsparticles', options: config.particles });
            }

            function toggleTheme() {
                currentTheme = currentTheme === 'dark' ? 'light' : 'dark';
                localStorage.setItem('theme', currentTheme);
                applyTheme(currentTheme);
            }

            $('#theme-toggle-button').on('click', toggleTheme);

            // --- NEW: Centralized Command Interpreter Function ---
            function interpreter(command) {
                const parts = command.trim().split(/\s+/);
                const cmd = parts[0].toLowerCase();
                const args = parts.slice(1);

                switch (cmd) {
                    case 'help':
                        this.echo(`Comandi disponibili:\n` +
                                  `  [[b;white;]help]              - Mostra questa guida.\n` +
                                  `  [[b;white;]wiki <termine>]    - Cerca un termine su Wikipedia.\n` +
                                  `  [[b;white;]sentiment <testo>] - Analizza il sentiment di una frase.`);
                        break;

                    case 'wiki':
                        if (args.length === 0) {
                            this.error('Uso: wiki <termine di ricerca>');
                            return;
                        }
                        const searchTerm = args.join(' ');
                        const api_url = `https://it.wikipedia.org/w/api.php?format=json&action=query&prop=extracts&exintro&explaintext&redirects=1&titles=${encodeURIComponent(searchTerm)}&origin=*`;
                        this.pause();
                        $.ajax({ url: api_url, dataType: 'json' })
                            .done(data => {
                                const pages = data.query.pages;
                                const pageId = Object.keys(pages)[0];
                                if (pageId === '-1') {
                                    this.error(`Nessun risultato trovato per "${searchTerm}".`);
                                } else {
                                    const extract = pages[pageId].extract;
                                    const formattedText = marked.parse(extract);
                                    this.echo(formattedText);
                                }
                            })
                            .fail(() => this.error('Errore durante la comunicazione con l'API di Wikipedia.'))
                            .always(() => this.resume());
                        break;

                    case 'sentiment':
                        if (args.length === 0) {
                            this.error('Uso: sentiment <testo da analizzare>');
                            return;
                        }
                        const textToAnalyze = args.join(' ');
                        const result = sentiment.analyze(textToAnalyze);
                        this.echo(`Analisi del sentiment:\n` +
                                  `  Punteggio: ${result.score}\n` +
                                  `  Positivo: ${result.positive.join(', ') || 'Nessuna'}\n` +
                                  `  Negativo: ${result.negative.join(', ') || 'Nessuna'}`);
                        break;

                    default:
                        if (cmd) { // Evita di mostrare l'errore per un invio vuoto
                           this.error(`Comando non riconosciuto: ${cmd}. Digita 'help' per la lista dei comandi.`);
                        }
                        break;
                }
            }

            term = $('#terminal').terminal(interpreter, {
                greetings: 'Ciao, sono Lorel Axun. Digita `help` per vedere la lista dei comandi.',
                prompt: currentTheme === 'dark' ? darkThemeConfig.terminal.prompt : lightThemeConfig.terminal.prompt,
                onInit: function() {
                    applyTheme(currentTheme);
                }
            });
        });
    </script>
</body>
</html>