<!DOCTYPE html>\n<html lang=\"it\" data-theme=\"dark\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Lorel Axun</title>\n    <script src=\"https://cdn.jsdelivr.net/npm/marked/marked.min.js\"></script>\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js\"></script>\n    <!-- NUOVA AGGIUNTA: Libreria per l'analisi del sentiment -->\n    <script src=\"https://cdn.jsdelivr.net/npm/sentiment@5.0.2/build/sentiment.min.js\"></script>\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css\">\n    <style>\n        :root {\n            --light-bg-color: #f0f2f5;\n            --light-chat-bg: #ffffff;\n            --light-text-color: #1c1e21;\n            --light-header-bg: #0078d4;\n            --light-header-text: #ffffff;\n            --light-user-msg-bg: #0084ff;\n            --light-user-msg-text: #ffffff;\n            --light-ai-msg-bg: #e4e6eb;\n            --light-ai-msg-text: #050505;\n            --light-input-bg: #ffffff;\n            --light-input-text: #050505;\n            --light-button-bg: #0078d4;\n            --light-button-text: #ffffff;\n            --light-scrollbar-thumb: #c1c1c1;\n            --light-scrollbar-track: #f1f1f1;\n\n            --dark-bg-color: #121212;\n            --dark-chat-bg: #1e1e1e;\n            --dark-text-color: #e0e0e0;\n            --dark-header-bg: #2a2a2a;\n            --dark-header-text: #ffffff;\n            --dark-user-msg-bg: #3a3b3c;\n            --dark-user-msg-text: #e4e6eb;\n            --dark-ai-msg-bg: #242526;\n            --dark-ai-msg-text: #e4e6eb;\n            --dark-input-bg: #3a3b3c;\n            --dark-input-text: #e4e6eb;\n            --dark-button-bg: #4a4a4a;\n            --dark-button-text: #ffffff;\n            --dark-scrollbar-thumb: #555;\n            --dark-scrollbar-track: #333;\n\n            --bg-color: var(--light-bg-color);\n            --chat-bg: var(--light-chat-bg);\n            --text-color: var(--light-text-color);\n            --header-bg: var(--light-header-bg);\n            --header-text: var(--light-header-text);\n            --user-msg-bg: var(--light-user-msg-bg);\n            --user-msg-text: var(--light-user-msg-text);\n            --ai-msg-bg: var(--light-ai-msg-bg);\n            --ai-msg-text: var(--light-ai-msg-text);\n            --input-bg: var(--light-input-bg);\n            --input-text: var(--light-input-text);\n            --button-bg: var(--light-button-bg);\n            --button-text: var(--light-button-text);\n            --scrollbar-thumb: var(--light-scrollbar-thumb);\n            --scrollbar-track: var(--light-scrollbar-track);\n        }\n\n        html[data-theme='dark'] {\n            --bg-color: var(--dark-bg-color);\n            --chat-bg: var(--dark-chat-bg);\n            --text-color: var(--dark-text-color);\n            --header-bg: var(--dark-header-bg);\n            --header-text: var(--dark-header-text);\n            --user-msg-bg: var(--dark-user-msg-bg);\n            --user-msg-text: var(--dark-user-msg-text);\n            --ai-msg-bg: var(--dark-ai-msg-bg);\n            --ai-msg-text: var(--dark-ai-msg-text);\n            --input-bg: var(--dark-input-bg);\n            --input-text: var(--dark-input-text);\n            --button-bg: var(--dark-button-bg);\n            --button-text: var(--dark-button-text);\n            --scrollbar-thumb: var(--dark-scrollbar-thumb);\n            --scrollbar-track: var(--dark-scrollbar-track);\n        }\n\n        @keyframes gradient {\n            0% { background-position: 0% 50%; }\n            50% { background-position: 100% 50%; }\n            100% { background-position: 0% 50%; }\n        }\n\n        body {\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;\n            margin: 0;\n            display: flex;\n            justify-content: center;\n            align-items: center;\n            height: 100vh;\n            color: var(--text-color);\n            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);\n            background-size: 400% 400%;\n            animation: gradient 15s ease infinite;\n        }\n\n        .chat-container {\n            width: 90%;\n            max-width: 800px;\n            height: 95vh;\n            background-color: var(--chat-bg);\n            border-radius: 12px;\n            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);\n            display: flex;\n            flex-direction: column;\n            overflow: hidden;\n        }\n\n        .chat-header {\n            background-color: var(--header-bg);\n            color: var(--header-text);\n            padding: 15px 20px;\n            font-size: 1.2em;\n            font-weight: bold;\n            border-bottom: 1px solid rgba(0,0,0,0.1);\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n        }\n        \n        #theme-toggle-button {\n            background: none;\n            border: 1px solid var(--header-text);\n            color: var(--header-text);\n            padding: 5px 10px;\n            border-radius: 5px;\n            cursor: pointer;\n            transition: background-color 0.3s, color 0.3s;\n        }\n\n        #theme-toggle-button:hover {\n            background-color: var(--header-text);\n            color: var(--header-bg);\n        }\n\n        .chat-messages {\n            flex-grow: 1;\n            padding: 20px;\n            overflow-y: auto;\n            display: flex;\n            flex-direction: column;\n            gap: 15px;\n        }\n\n        .chat-messages::-webkit-scrollbar {\n            width: 8px;\n        }\n\n        .chat-messages::-webkit-scrollbar-track {\n            background: var(--scrollbar-track);\n        }\n\n        .chat-messages::-webkit-scrollbar-thumb {\n            background-color: var(--scrollbar-thumb);\n            border-radius: 10px;\n            border: 2px solid var(--scrollbar-track);\n        }\n\n        .message {\n            padding: 12px 18px;\n            border-radius: 18px;\n            max-width: 80%;\n            line-height: 1.5;\n            word-wrap: break-word;\n        }\n\n        .message.user {\n            background-color: var(--user-msg-bg);\n            color: var(--user-msg-text);\n            align-self: flex-end;\n            border-bottom-right-radius: 4px;\n        }\n\n        .message.ai {\n            background-color: var(--ai-msg-bg);\n            color: var(--ai-msg-text);\n            align-self: flex-start;\n            border-bottom-left-radius: 4px;\n        }\n        \n        .message.ai pre {\n            position: relative;\n            background-color: #2d2d2d;\n            color: #f8f8f2;\n            padding: 1em;\n            border-radius: 8px;\n            overflow-x: auto;\n            margin-top: 10px;\n        }\n\n        .message.ai pre .copy-button {\n            position: absolute;\n            top: 10px;\n            right: 10px;\n            background-color: #555;\n            color: white;\n            border: none;\n            padding: 5px 10px;\n            border-radius: 5px;\n            cursor: pointer;\n            opacity: 0;\n            transition: opacity 0.3s;\n        }\n\n        .message.ai pre:hover .copy-button {\n            opacity: 1;\n        }\n\n        .typing-indicator {\n            display: flex;\n            align-items: center;\n            gap: 5px;\n        }\n\n        .typing-indicator span {\n            width: 8px;\n            height: 8px;\n            background-color: var(--ai-msg-text);\n            border-radius: 50%;\n            animation: bounce 1.4s infinite ease-in-out both;\n        }\n\n        .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }\n        .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }\n\n        @keyframes bounce {\n            0%, 80%, 100% { transform: scale(0); }\n            40% { transform: scale(1.0); }\n        }\n\n        .chat-input {\n            display: flex;\n            padding: 15px;\n            border-top: 1px solid rgba(0,0,0,0.1);\n        }\n\n        #user-input {\n            flex-grow: 1;\n            padding: 12px;\n            border: 1px solid #ccc;\n            border-radius: 20px;\n            resize: none;\n            font-size: 1em;\n            margin-right: 10px;\n            background-color: var(--input-bg);\n            color: var(--input-text);\n            border-color: var(--scrollbar-thumb);\n        }\n\n        #user-input:focus {\n            outline: none;\n            border-color: var(--user-msg-bg);\n            box-shadow: 0 0 5px var(--user-msg-bg);\n        }\n\n        #send-button {\n            padding: 12px 20px;\n            border: none;\n            background-color: var(--button-bg);\n            color: var(--button-text);\n            border-radius: 20px;\n            cursor: pointer;\n            font-size: 1em;\n            font-weight: bold;\n        }\n    </style>\n</head>\n<body>\n    <div class=\"chat-container\">\n        <header class=\"chat-header\">\n            <h1>Lorel Axun</h1>\n            <button id=\"theme-toggle-button\">Tema</button>\n        </header>\n        <div class=\"chat-messages\" id=\"chat-messages\"></div>\n        <div class=\"chat-input\">\n            <textarea id=\"user-input\" placeholder=\"Scrivi un messaggio...\" rows=\"1\"></textarea>\n            <button id=\"send-button\">Invia</button>\n        </div>\n    </div>\n\n    <script>\n        const chatMessages = document.getElementById('chat-messages');\n        const userInput = document.getElementById('user-input');\n        const sendButton = document.getElementById('send-button');\n        const themeToggleButton = document.getElementById('theme-toggle-button');\n\n        let chatHistory = [];\n\n        // Gestione Tema\n        const applyTheme = (theme) => {\n            document.documentElement.setAttribute('data-theme', theme);\n            localStorage.setItem('lorel_axun_theme', theme);\n        };\n\n        themeToggleButton.addEventListener('click', () => {\n            const currentTheme = document.documentElement.getAttribute('data-theme');\n            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';\n            applyTheme(newTheme);\n        });\n\n        // Carica cronologia e tema\n        window.addEventListener('load', () => {\n            const savedHistory = localStorage.getItem('lorel_axun_history');\n            if (savedHistory) {\n                chatHistory = JSON.parse(savedHistory);\n                chatHistory.forEach(msg => addMessage(msg.sender, msg.text));\n            } else {\n                addMessage('ai', 'Ciao, sono Lorel Axun. Come posso aiutarti?');\n            }\n\n            const savedTheme = localStorage.getItem('lorel_axun_theme') || 'dark';\n            applyTheme(savedTheme);\n        });\n\n        const saveHistory = () => {\n            localStorage.setItem('lorel_axun_history', JSON.stringify(chatHistory));\n        };\n\n        const addMessage = (sender, text) => {\n            const messageElement = document.createElement('div');\n            messageElement.classList.add('message', sender);\n            \n            const renderedText = marked.parse(text);\n            messageElement.innerHTML = renderedText;\n            \n            chatMessages.appendChild(messageElement);\n            \n            // Aggiungi pulsante copia ai blocchi di codice\n            messageElement.querySelectorAll('pre code').forEach(block => {\n                hljs.highlightElement(block);\n                const preElement = block.parentElement;\n                const copyButton = document.createElement('button');\n                copyButton.innerText = 'Copia';\n                copyButton.className = 'copy-button';\n                copyButton.onclick = () => {\n                    navigator.clipboard.writeText(block.innerText).then(() => {\n                        copyButton.innerText = 'Copiato!';\n                        setTimeout(() => { copyButton.innerText = 'Copia'; }, 2000);\n                    });\n                };\n                preElement.appendChild(copyButton);\n            });\n\n            chatMessages.scrollTop = chatMessages.scrollHeight;\n            \n            if (sender !== 'system') { // Non salvare i messaggi di sistema iniziali\n                chatHistory.push({ sender, text });\n                saveHistory();\n            }\n        };\n\n        const handleUserInput = async () => {\n            const text = userInput.value.trim();\n            if (text) {\n                addMessage('user', text);\n                userInput.value = '';\n                userInput.style.height = 'auto';\n                showTypingIndicator();\n                const aiResponse = await getAiResponse(text);\n                hideTypingIndicator();\n                addMessage('ai', aiResponse);\n            }\n        };\n\n        const showTypingIndicator = () => {\n            const indicator = document.createElement('div');\n            indicator.id = 'typing-indicator';\n            indicator.classList.add('message', 'ai', 'typing-indicator');\n            indicator.innerHTML = '<span></span><span></span><span></span>';\n            chatMessages.appendChild(indicator);\n            chatMessages.scrollTop = chatMessages.scrollHeight;\n        };\n\n        const hideTypingIndicator = () => {\n            const indicator = document.getElementById('typing-indicator');\n            if (indicator) {\n                indicator.remove();\n            }\n        };\n\n        const getAiResponse = async (userInput) => {\n            let aiResponse = \"Non ho capito la tua richiesta. Prova a usare comandi come `wiki: <termine>`.\";\n\n            if (userInput.toLowerCase().startsWith('wiki:')) {\n                const searchTerm = userInput.substring(5).trim();\n                if (searchTerm) {\n                    try {\n                        const url = `https://it.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(searchTerm)}`;\n                        const response = await fetch(url);\n                        if (!response.ok) throw new Error(`Wikipedia ha risposto con stato ${response.status}`);\n                        const data = await response.json();\n                        aiResponse = `**${data.title}**\\n\\n${data.extract}`;\n                    } catch (error) {\n                        console.error(error);\n                        aiResponse = `Mi dispiace, non sono riuscito a trovare informazioni su \"${searchTerm}\" su Wikipedia.`;\n                    }\n                } else {\n                    aiResponse = 'Per favore, specifica un termine da cercare su Wikipedia dopo \"wiki:\".';\n                }\n            } else if (userInput.toLowerCase().startsWith('news:')) {\n                aiResponse = 'La funzionalità notizie è in fase di sviluppo. La chiave API non è ancora stata configurata per motivi di sicurezza.';\n            } else if (userInput.toLowerCase().startsWith('sentiment:')) {\n                const textToAnalyze = userInput.substring(10).trim();\n                if (textToAnalyze) {\n                    try {\n                        const sentiment = new Sentiment();\n                        const result = sentiment.analyze(textToAnalyze, { language: 'it' });\n                        let sentimentDescription = 'neutro';\n                        if (result.score > 0) {\n                            sentimentDescription = 'positivo';\n                        } else if (result.score < 0) {\n                            sentimentDescription = 'negativo';\n                        }\n                        aiResponse = `Analisi del sentiment completata.\\n- **Punteggio:** ${result.score}\\n- **Valutazione:** Il tono del testo sembra **${sentimentDescription}**.`;\n                    } catch (error) {\n                        console.error(\"Errore durante l'analisi del sentiment:\", error);\n                        aiResponse = \"Si è verificato un errore durante l'inizializzazione della libreria di analisi del sentiment. Potrebbe non essere stata caricata correttamente.\";\n                    }\n                } else {\n                    aiResponse = 'Per favore, fornisci del testo da analizzare dopo `sentiment:`.';\n                }\n            }\n            return aiResponse;\n        };\n\n        sendButton.addEventListener('click', handleUserInput);\n        userInput.addEventListener('keydown', (e) => {\n            if (e.key === 'Enter' && !e.shiftKey) {\n                e.preventDefault();\n                handleUserInput();\n            }\n        });\n\n        userInput.addEventListener('input', () => {\n            userInput.style.height = 'auto';\n            userInput.style.height = (userInput.scrollHeight) + 'px';\n        });\n    </script>\n</body>\n</html>