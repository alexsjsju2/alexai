<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lorel Axun</title>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery.terminal@2.39.4/js/jquery.terminal.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jquery.terminal@2.39.4/css/jquery.terminal.min.css"/>
    <script src="https://cdn.jsdelivr.net/npm/tsparticles@3.4.0/tsparticles.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sentiment@5.0.2/lib/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/node-nlp@4.27.0/lib/nlp.min.js"></script>
    <style>
        :root {
            --background-color-dark: #0D1117;
            --text-color-dark: #C9D1D9;
            --terminal-background-dark: #010409;
            --terminal-text-dark: #58A6FF;
            --terminal-glow-dark: #1F6FEB;
            --header-bg-dark: rgba(13, 17, 23, 0.8);

            --background-color-light: #F0F2F5;
            --text-color-light: #24292F;
            --terminal-background-light: #FFFFFF;
            --terminal-text-light: #0969DA;
            --terminal-glow-light: #8B949E;
            --header-bg-light: rgba(240, 242, 245, 0.8);
        }

        html[data-theme='dark'] {
            --background-color: var(--background-color-dark);
            --text-color: var(--text-color-dark);
            --terminal-background: var(--terminal-background-dark);
            --terminal-text: var(--terminal-text-dark);
            --terminal-glow: var(--terminal-glow-dark);
            --header-bg: var(--header-bg-dark);
        }

        html[data-theme='light'] {
            --background-color: var(--background-color-light);
            --text-color: var(--text-color-light);
            --terminal-background: var(--terminal-background-light);
            --terminal-text: var(--terminal-text-light);
            --terminal-glow: var(--terminal-glow-light);
            --header-bg: var(--header-bg-light);
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Courier New', Courier, monospace;
            background-color: var(--background-color);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        #tsparticles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            background-color: var(--header-bg);
            backdrop-filter: blur(5px);
            border-bottom: 1px solid var(--terminal-glow);
            position: fixed;
            width: 100%;
            top: 0;
            left: 0;
            z-index: 1000;
            box-sizing: border-box;
        }

        .header h1 {
            margin: 0;
            font-size: 1.5em;
            color: var(--terminal-text);
            text-shadow: 0 0 5px var(--terminal-glow);
        }

        #theme-toggle-button {
            background: none;
            border: 1px solid var(--terminal-text);
            color: var(--terminal-text);
            padding: 5px 10px;
            cursor: pointer;
            border-radius: 5px;
        }

        #terminal {
            flex-grow: 1;
            padding-top: 60px; /* Height of header */
            --background: var(--terminal-background);
            --color: var(--terminal-text);
            --cursor-glow: 0;
        }
    </style>
</head>
<body>
    <div id="tsparticles"></div>
    <div class="header">
        <h1>Lorel Axun</h1>
        <button id="theme-toggle-button">Toggle Theme</button>
    </div>
    <div id="terminal"></div>

    <script>
        $(function() {
            const { NlpManager } = nlpjs;
            const manager = new NlpManager({ languages: ['en'], forceNER: true });
            const sentiment = new Sentiment();

            // --- NLP Training ---
            manager.addDocument('en', 'hello', 'greetings.hello');
            manager.addDocument('en', 'hi', 'greetings.hello');
            manager.addDocument('en', 'goodbye', 'greetings.bye');
            manager.addDocument('en', 'bye', 'greetings.bye');
            manager.addDocument('en', 'who are you', 'agent.identity');
            manager.addDocument('en', 'what are you', 'agent.identity');

            manager.addAnswer('en', 'greetings.hello', 'Hello there!');
            manager.addAnswer('en', 'greetings.bye', 'Goodbye!');
            manager.addAnswer('en', 'agent.identity', 'I am Lorel Axun, a digital entity in constant evolution.');

            (async() => {
                await manager.train();
                manager.save();
            })();

            // --- Conversation History & Context ---
            let conversationHistory = [];
            const HISTORY_KEY = 'lorel_axun_history';

            function saveHistory() {
                try {
                    localStorage.setItem(HISTORY_KEY, JSON.stringify(conversationHistory));
                } catch (e) {
                    console.error("Failed to save history:", e);
                }
            }

            function loadHistory(term) {
                const saved = localStorage.getItem(HISTORY_KEY);
                if (saved) {
                    try {
                        conversationHistory = JSON.parse(saved);
                        term.echo("Welcome back. I've loaded our previous conversation.");
                    } catch (e) {
                        console.error("Failed to load history:", e);
                        conversationHistory = [];
                    }
                }
            }

            // --- Terminal Implementation ---
            const term = $('#terminal').terminal(async function(command, term) {
                let response = '';
                let interactionContext = {};

                const commands = {
                    'help': () => {
                        return 'Available commands: help, wiki <term>, sentiment <text>, clear, tell me more.';
                    },
                    'wiki': async (term, ...args) => {
                        const query = args.join(' ');
                        if (!query) return 'Usage: wiki <search term>';
                        term.pause();
                        try {
                            const url = `https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(query)}`;
                            const response = await fetch(url);
                            if (!response.ok) throw new Error(`Wikipedia API error: ${response.statusText}`);
                            const data = await response.json();
                            interactionContext = { action: 'wiki', topic: data.title };
                            return `[[b;${'var(--terminal-text)'};]${data.title}]\n\n${marked.parse(data.extract)}`;
                        } catch (error) {
                            return `Error fetching from Wikipedia: ${error.message}`;
                        } finally {
                            term.resume();
                        }
                    },
                    'sentiment': (term, ...args) => {
                        const text = args.join(' ');
                        if (!text) return 'Usage: sentiment <text>';
                        const result = sentiment.analyze(text);
                        let coloredText = '';
                        result.words.forEach(word => {
                            const score = result.calculation.find(c => c[word])?.[word] || 0;
                            if (score > 0) coloredText += `[[;lime;]${word}] `;
                            else if (score < 0) coloredText += `[[;red;]${word}] `;
                            else coloredText += `${word} `;
                        });
                        return `Score: ${result.score}\nComparative: ${result.comparative.toFixed(2)}\n\n${coloredText}`;
                    },
                    'clear': () => {
                        conversationHistory = [];
                        localStorage.removeItem(HISTORY_KEY);
                        term.clear();
                        return 'Conversation history cleared.';
                    },
                    'tell me more': () => {
                        const lastWikiInteraction = conversationHistory.slice().reverse().find(h => h.context && h.context.action === 'wiki');
                        if (lastWikiInteraction) {
                            return `I can't provide more details yet, but our last topic was: ${lastWikiInteraction.context.topic}. This feature is under development.`;
                        } else {
                            return "Tell me more about what? I don't have a recent topic in memory.";
                        }
                    }
                };

                const [cmdName, ...args] = command.trim().split(/\s+/);

                if (commands[cmdName]) {
                    response = await commands[cmdName](term, ...args);
                } else {
                    const nlpResponse = await manager.process('en', command);
                    response = nlpResponse.answer || "I don't understand that. Type 'help' for available commands.";
                }

                if (response) term.echo(response, { raw: true });
                
                conversationHistory.push({ command, response, context: interactionContext });
                saveHistory();

            }, {
                greetings: 'Lorel Axun. Type \'help\' for a list of commands.',
                prompt: '> ',
                onInit: function() {
                    loadHistory(this);
                }
            });

            // --- Theme and Particles ---
            let currentTheme = localStorage.getItem('theme') || 'dark';
            $('html').attr('data-theme', currentTheme);

            const particlesConfig = {
                dark: {
                    particles: {
                        number: { value: 80 },
                        color: { value: "#58A6FF" },
                        links: { color: "#58A6FF", distance: 150, enable: true, opacity: 0.2 },
                        move: { enable: true, speed: 1 },
                        size: { value: { min: 1, max: 3 } },
                        opacity: { value: { min: 0.1, max: 0.5 } }
                    }
                },
                light: {
                    particles: {
                        number: { value: 80 },
                        color: { value: "#0969DA" },
                        links: { color: "#0969DA", distance: 150, enable: true, opacity: 0.2 },
                        move: { enable: true, speed: 1 },
                        size: { value: { min: 1, max: 3 } },
                        opacity: { value: { min: 0.1, max: 0.5 } }
                    }
                }
            };

            let particlesInstance;
            async function loadParticles(theme) {
                if (particlesInstance) {
                    particlesInstance.destroy();
                }
                particlesInstance = await tsParticles.load({ id: "tsparticles", options: particlesConfig[theme] });
            }

            $('#theme-toggle-button').on('click', () => {
                currentTheme = currentTheme === 'dark' ? 'light' : 'dark';
                $('html').attr('data-theme', currentTheme);
                localStorage.setItem('theme', currentTheme);
                loadParticles(currentTheme);
            });

            loadParticles(currentTheme);
        });
    </script>
</body>
</html>