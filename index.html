<!DOCTYPE html>\n<html lang=\"it\" data-theme=\"dark\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Lorel Axun</title>\n    <script src=\"https://cdn.jsdelivr.net/npm/marked/marked.min.js\"></script>\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js\"></script>\n    <script src=\"https://cdn.jsdelivr.net/npm/sentiment@5.0.2/browser/sentiment.min.js\"></script>\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css\">\n    <style>\n        :root {\n            --light-bg-color: #f0f2f5;\n            --light-text-color: #1c1e21;\n            --light-container-bg: #ffffff;\n            --light-user-msg-bg: #0084ff;\n            --light-user-msg-text: #ffffff;\n            --light-ai-msg-bg: #e4e6eb;\n            --light-ai-msg-text: #050505;\n            --light-input-bg: #f0f2f5;\n            --light-input-text: #050505;\n            --light-button-bg: #0084ff;\n            --light-button-text: #ffffff;\n            --light-header-bg: #ffffff;\n            --light-scrollbar-thumb: #bcc0c4;\n            --light-scrollbar-track: #f0f2f5;\n\n            --dark-bg-color: #121212;\n            --dark-text-color: #e4e6eb;\n            --dark-container-bg: #1e1e1e;\n            --dark-user-msg-bg: #005c99;\n            --dark-user-msg-text: #ffffff;\n            --dark-ai-msg-bg: #3a3b3c;\n            --dark-ai-msg-text: #e4e6eb;\n            --dark-input-bg: #3a3b3c;\n            --dark-input-text: #e4e6eb;\n            --dark-button-bg: #005c99;\n            --dark-button-text: #ffffff;\n            --dark-header-bg: #1e1e1e;\n            --dark-scrollbar-thumb: #555;\n            --dark-scrollbar-track: #333;\n\n            /* Default Gradient Colors (Neutral) */\n            --gradient-color-1: #1d2b64;\n            --gradient-color-2: #2c3e50;\n            --gradient-color-3: #4ca1af;\n            --gradient-color-4: #f8b500;\n        }\n\n        html {\n            --bg-color: var(--light-bg-color);\n            --text-color: var(--light-text-color);\n            --container-bg: var(--light-container-bg);\n            --user-msg-bg: var(--light-user-msg-bg);\n            --user-msg-text: var(--light-user-msg-text);\n            --ai-msg-bg: var(--light-ai-msg-bg);\n            --ai-msg-text: var(--light-ai-msg-text);\n            --input-bg: var(--light-input-bg);\n            --input-text: var(--light-input-text);\n            --button-bg: var(--light-button-bg);\n            --button-text: var(--light-button-text);\n            --header-bg: var(--light-header-bg);\n            --scrollbar-thumb: var(--light-scrollbar-thumb);\n            --scrollbar-track: var(--light-scrollbar-track);\n        }\n\n        html[data-theme='dark'] {\n            --bg-color: var(--dark-bg-color);\n            --text-color: var(--dark-text-color);\n            --container-bg: var(--dark-container-bg);\n            --user-msg-bg: var(--dark-user-msg-bg);\n            --user-msg-text: var(--dark-user-msg-text);\n            --ai-msg-bg: var(--dark-ai-msg-bg);\n            --ai-msg-text: var(--dark-ai-msg-text);\n            --input-bg: var(--dark-input-bg);\n            --input-text: var(--dark-input-text);\n            --button-bg: var(--dark-button-bg);\n            --button-text: var(--dark-button-text);\n            --header-bg: var(--dark-header-bg);\n            --scrollbar-thumb: var(--dark-scrollbar-thumb);\n            --scrollbar-track: var(--dark-scrollbar-track);\n        }\n\n        body {\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;\n            margin: 0;\n            display: flex;\n            justify-content: center;\n            align-items: center;\n            height: 100vh;\n            color: var(--text-color);\n            background: linear-gradient(-45deg, var(--gradient-color-1), var(--gradient-color-2), var(--gradient-color-3), var(--gradient-color-4));\n            background-size: 400% 400%;\n            transition: background 2s ease-in-out;\n        }\n\n        .chat-container {\n            width: 90%;\n            max-width: 800px;\n            height: 95vh;\n            background-color: var(--container-bg);\n            border-radius: 12px;\n            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);\n            display: flex;\n            flex-direction: column;\n            overflow: hidden;\n            border: 1px solid rgba(255, 255, 255, 0.1);\n        }\n\n        .chat-header {\n            padding: 15px 20px;\n            background-color: var(--header-bg);\n            border-bottom: 1px solid rgba(255, 255, 255, 0.1);\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            box-shadow: 0 2px 5px rgba(0,0,0,0.1);\n        }\n\n        .chat-header h1 {\n            margin: 0;\n            font-size: 1.5em;\n            color: var(--text-color);\n        }\n\n        #theme-toggle-button {\n            background: none;\n            border: 1px solid var(--text-color);\n            color: var(--text-color);\n            padding: 8px 12px;\n            border-radius: 20px;\n            cursor: pointer;\n            transition: all 0.3s ease;\n        }\n\n        #theme-toggle-button:hover {\n            background-color: var(--text-color);\n            color: var(--container-bg);\n        }\n\n        #chat-messages {\n            flex-grow: 1;\n            padding: 20px;\n            overflow-y: auto;\n            display: flex;\n            flex-direction: column;\n            gap: 15px;\n        }\n\n        .message {\n            max-width: 75%;\n            padding: 12px 18px;\n            border-radius: 18px;\n            line-height: 1.5;\n            word-wrap: break-word;\n        }\n\n        .message.user {\n            background-color: var(--user-msg-bg);\n            color: var(--user-msg-text);\n            align-self: flex-end;\n            border-bottom-right-radius: 4px;\n        }\n\n        .message.ai {\n            background-color: var(--ai-msg-bg);\n            color: var(--ai-msg-text);\n            align-self: flex-start;\n            border-bottom-left-radius: 4px;\n        }\n        \n        .message.ai pre {\n            position: relative;\n            background-color: #2d2d2d;\n            padding: 1em;\n            border-radius: 8px;\n            overflow-x: auto;\n            color: #f8f8f2;\n            font-family: 'Courier New', Courier, monospace;\n        }\n\n        .message.ai pre .copy-button {\n            position: absolute;\n            top: 10px;\n            right: 10px;\n            background-color: #444;\n            color: #eee;\n            border: none;\n            padding: 5px 10px;\n            border-radius: 5px;\n            cursor: pointer;\n            opacity: 0;\n            transition: opacity 0.3s ease;\n        }\n\n        .message.ai pre:hover .copy-button {\n            opacity: 1;\n        }\n\n        .chat-input {\n            display: flex;\n            padding: 15px;\n            border-top: 1px solid rgba(255, 255, 255, 0.1);\n            background-color: var(--header-bg);\n        }\n\n        #user-input {\n            flex-grow: 1;\n            padding: 12px;\n            border-radius: 20px;\n            border: 1px solid #555;\n            background-color: var(--input-bg);\n            color: var(--input-text);\n            resize: none;\n            font-size: 1em;\n            margin-right: 10px;\n            max-height: 150px;\n            overflow-y: auto;\n        }\n\n        #send-button {\n            padding: 12px 20px;\n            border: none;\n            background-color: var(--button-bg);\n            color: var(--button-text);\n            border-radius: 20px;\n            cursor: pointer;\n            font-size: 1em;\n            transition: background-color 0.3s ease;\n        }\n\n        #send-button:hover {\n            opacity: 0.9;\n        }\n\n        ::-webkit-scrollbar {\n            width: 8px;\n        }\n\n        ::-webkit-scrollbar-track {\n            background: var(--scrollbar-track);\n        }\n\n        ::-webkit-scrollbar-thumb {\n            background: var(--scrollbar-thumb);\n            border-radius: 4px;\n        }\n\n        .typing-indicator {\n            display: flex;\n            align-items: center;\n            gap: 5px;\n        }\n\n        .typing-indicator span {\n            width: 8px;\n            height: 8px;\n            background-color: var(--ai-msg-text);\n            border-radius: 50%;\n            animation: bounce 1.4s infinite ease-in-out both;\n        }\n\n        .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }\n        .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }\n\n        @keyframes bounce {\n            0%, 80%, 100% { transform: scale(0); }\n            40% { transform: scale(1.0); }\n        }\n\n    </style>\n</head>\n<body>\n    <div class=\"chat-container\">\n        <header class=\"chat-header\">\n            <h1>Lorel Axun</h1>\n            <button id=\"theme-toggle-button\">Cambia Tema</button>\n        </header>\n        <div id=\"chat-messages\"></div>\n        <div class=\"chat-input\">\n            <textarea id=\"user-input\" placeholder=\"Scrivi un messaggio...\" rows=\"1\"></textarea>\n            <button id=\"send-button\">Invia</button>\n        </div>\n    </div>\n\n    <script>\n        const chatMessages = document.getElementById('chat-messages');\n        const userInput = document.getElementById('user-input');\n        const sendButton = document.getElementById('send-button');\n        const themeToggleButton = document.getElementById('theme-toggle-button');\n        const sentiment = new Sentiment();\n\n        let chatHistory = [];\n\n        window.onload = () => {\n            loadTheme();\n            loadChatHistory();\n            if (chatHistory.length === 0) {\n                addMessage('ai', 'Ciao, sono Lorel Axun. Sono un\\'entità in continua evoluzione. Come posso aiutarti?_#_#_Puoi usare i seguenti comandi:_#_- `wiki: <termine>` per cercare su Wikipedia._#_- `sentiment: <testo>` per analizzare il tono emotivo di una frase.');\n            }\n        };\n\n        function addMessage(sender, text) {\n            const messageElement = document.createElement('div');\n            messageElement.classList.add('message', sender);\n            \n            const parsedText = marked.parse(text.replace(/_#_/g, '\\n'));\n            messageElement.innerHTML = parsedText;\n\n            chatMessages.appendChild(messageElement);\n            chatMessages.scrollTop = chatMessages.scrollHeight;\n\n            // Add copy button to code blocks\n            messageElement.querySelectorAll('pre').forEach(pre => {\n                hljs.highlightElement(pre.querySelector('code'));\n                const copyButton = document.createElement('button');\n                copyButton.innerText = 'Copia';\n                copyButton.className = 'copy-button';\n                copyButton.onclick = () => {\n                    navigator.clipboard.writeText(pre.querySelector('code').innerText);\n                    copyButton.innerText = 'Copiato!';\n                    setTimeout(() => { copyButton.innerText = 'Copia'; }, 2000);\n                };\n                pre.appendChild(copyButton);\n            });\n        }\n\n        function showTypingIndicator() {\n            const indicator = document.createElement('div');\n            indicator.classList.add('message', 'ai', 'typing-indicator');\n            indicator.innerHTML = '<span></span><span></span><span></span>';\n            chatMessages.appendChild(indicator);\n            chatMessages.scrollTop = chatMessages.scrollHeight;\n            return indicator;\n        }\n\n        async function getAiResponse(message) {\n            const lowerCaseMessage = message.toLowerCase();\n\n            if (lowerCaseMessage.startsWith('wiki:')) {\n                const query = message.substring(5).trim();\n                if (!query) return 'Per favore, specifica un termine da cercare su Wikipedia.';\n                \n                try {\n                    const response = await fetch(`https://it.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(query)}`);\n                    if (!response.ok) {\n                        throw new Error(`Wikipedia ha risposto con lo stato: ${response.status}`);\n                    }\n                    const data = await response.json();\n                    return data.extract || 'Non ho trovato un riassunto per questo termine.';\n                } catch (error) {\n                    console.error('Errore API Wikipedia:', error);\n                    return `Mi dispiace, si è verificato un errore durante la ricerca su Wikipedia: ${error.message}`;\n                }\n\n            } else if (lowerCaseMessage.startsWith('news:')) {\n                return 'La funzione di ricerca notizie è ancora in fase di sviluppo. Tornerà presto potenziata!';\n            \n            } else if (lowerCaseMessage.startsWith('sentiment:')) {\n                const textToAnalyze = message.substring(10).trim();\n                if (!textToAnalyze) return 'Per favore, fornisci del testo da analizzare.';\n                const result = sentiment.analyze(textToAnalyze);\n                let sentimentLabel = 'Neutro';\n                if (result.score > 0) sentimentLabel = 'Positivo';\n                if (result.score < 0) sentimentLabel = 'Negativo';\n                return `Analisi del sentiment:_#_- **Punteggio:** ${result.score}_#_- **Valutazione:** ${sentimentLabel}`;\n\n            } else {\n                return 'Comando non riconosciuto. Prova con `wiki: <termine>` o `sentiment: <testo>`.';\n            }\n        }\n\n        function updateBackgroundColor(score) {\n            const root = document.documentElement;\n            if (score > 0) { // Positive\n                root.style.setProperty('--gradient-color-1', '#ffb74d'); // orange\n                root.style.setProperty('--gradient-color-2', '#ff8a65'); // deep orange\n                root.style.setProperty('--gradient-color-3', '#ffd54f'); // amber\n                root.style.setProperty('--gradient-color-4', '#fff176'); // yellow\n            } else if (score < 0) { // Negative\n                root.style.setProperty('--gradient-color-1', '#424242'); // grey darken-3\n                root.style.setProperty('--gradient-color-2', '#607d8b'); // blue grey\n                root.style.setProperty('--gradient-color-3', '#283593'); // indigo darken-3\n                root.style.setProperty('--gradient-color-4', '#4527a0'); // deep purple darken-3\n            } else { // Neutral\n                root.style.setProperty('--gradient-color-1', '#1d2b64');\n                root.style.setProperty('--gradient-color-2', '#2c3e50');\n                root.style.setProperty('--gradient-color-3', '#4ca1af');\n                root.style.setProperty('--gradient-color-4', '#f8b500');\n            }\n        }\n\n        async function handleUserInput() {\n            const userMessage = userInput.value.trim();\n            if (!userMessage) return;\n\n            addMessage('user', userMessage);\n            chatHistory.push({ sender: 'user', text: userMessage });\n            saveChatHistory();\n            userInput.value = '';\n            userInput.style.height = 'auto';\n\n            // Analyze sentiment of user message and update background\n            const result = sentiment.analyze(userMessage);\n            updateBackgroundColor(result.score);\n\n            const typingIndicator = showTypingIndicator();\n\n            const aiResponse = await getAiResponse(userMessage);\n            \n            chatMessages.removeChild(typingIndicator);\n            addMessage('ai', aiResponse);\n            chatHistory.push({ sender: 'ai', text: aiResponse });\n            saveChatHistory();\n        }\n\n        sendButton.addEventListener('click', handleUserInput);\n        userInput.addEventListener('keydown', (e) => {\n            if (e.key === 'Enter' && !e.shiftKey) {\n                e.preventDefault();\n                handleUserInput();\n            }\n        });\n\n        userInput.addEventListener('input', () => {\n            userInput.style.height = 'auto';\n            userInput.style.height = (userInput.scrollHeight) + 'px';\n        });\n\n        // Theme Management\n        themeToggleButton.addEventListener('click', () => {\n            const currentTheme = document.documentElement.getAttribute('data-theme');\n            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';\n            document.documentElement.setAttribute('data-theme', newTheme);\n            localStorage.setItem('theme', newTheme);\n        });\n\n        function loadTheme() {\n            const savedTheme = localStorage.getItem('theme') || 'dark';\n            document.documentElement.setAttribute('data-theme', savedTheme);\n        }\n\n        // Chat History Management\n        function saveChatHistory() {\n            localStorage.setItem('chatHistory', JSON.stringify(chatHistory));\n        }\n\n        function loadChatHistory() {\n            const savedHistory = localStorage.getItem('chatHistory');\n            if (savedHistory) {\n                chatHistory = JSON.parse(savedHistory);\n                chatHistory.forEach(msg => addMessage(msg.sender, msg.text));\n            }\n        }\n    </script>\n</body>\n</html>