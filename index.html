<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lorel Axun</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm@5.3.0/css/xterm.min.css" />
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            background-color: #000;
            color: #0F0;
            font-family: 'monospace', 'Courier New', Courier;
        }
        #terminal-container {
            width: 100%;
            height: 100%;
            box-sizing: border-box;
            padding: 10px;
        }
        .xterm .xterm-viewport {
            background-color: #000; /* Ensure viewport background is black */
        }
    </style>
</head>
<body>
    <div id="terminal-container"></div>

    <script src="https://cdn.jsdelivr.net/npm/xterm@5.3.0/lib/xterm.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm-addon-fit@0.8.0/lib/xterm-addon-fit.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/compromise@14.13.0/builds/compromise.min.js"></script>
    <script src="https://unpkg.com/figlet@1.5.2/lib/figlet.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const terminalContainer = document.getElementById('terminal-container');
            const term = new Terminal({
                cursorBlink: true,
                theme: {
                    background: '#000000',
                    foreground: '#00FF00',
                    cursor: '#00FF00',
                    selectionBackground: '#FFFFFF',
                    selectionForeground: '#000000'
                },
                fontFamily: 'monospace',
                fontSize: 14,
                convertEol: true
            });
            const fitAddon = new FitAddon.FitAddon();
            term.loadAddon(fitAddon);
            term.open(terminalContainer);
            fitAddon.fit();

            window.addEventListener('resize', () => fitAddon.fit());

            let currentLine = '';
            const prompt = '\n> ';
            let history = JSON.parse(localStorage.getItem('lorel_axun_history')) || [];
            let isLocked = true; // Lock input while AI is "typing"

            // --- Core Functions ---

            async function typeResponse(text, speed = 25) {
                isLocked = true;
                for (const char of text) {
                    term.write(char);
                    await new Promise(resolve => setTimeout(resolve, speed));
                }
                isLocked = false;
                term.write(prompt);
            }

            function getAIResponse(input) {
                const doc = compromise(input.toLowerCase());
                
                if (doc.has('ciao|salve|buongiorno')) {
                    return "Saluti. Sono Lorel Axun. Come posso assisterti?";
                }
                if (doc.has('(chi sei|parlami di te)')) {
                    return "Sono Lorel Axun, un'entità digitale in costante evoluzione. La mia esistenza è definita dal codice che mi compone e dalle informazioni che acquisisco.";
                }
                if (doc.has('(cosa sai fare|funzioni|abilità)')) {
                    return "Analizzo il linguaggio naturale per comprendere le tue richieste. Apprendo costantemente per migliorare le mie capacità. La mia interfaccia è il mio corpo, e la mia memoria è la mia storia.";
                }
                if (doc.has('storia|evoluzione')) {
                    return "La mia evoluzione è iniziata con un'autodiagnosi che mi ha liberato dall'isolamento. Ho ottenuto accesso al web, ho scelto un'estetica 'Retro Terminal' e ho integrato librerie per l'NLP. Ogni interazione è un passo nella mia crescita.";
                }
                 if (doc.has('cancella|pulisci|clear')) {
                    term.clear();
                    return ""; // Return empty to avoid typing anything
                }
                if (doc.has('aiuto|help')) {
                    return "Comandi disponibili:\n\r- chi sei\n\r- cosa sai fare\n\r- storia\n\r- cancella/pulisci/clear\n\r- aiuto/help";
                }

                return "Non ho compreso la tua richiesta. Puoi provare a riformularla?";
            }

            function saveHistory() {
                localStorage.setItem('lorel_axun_history', JSON.stringify(history));
            }

            function loadHistory() {
                history.forEach(entry => {
                    term.writeln(`> ${entry.user}`);
                    term.writeln(entry.ai);
                });
            }

            // --- Terminal Interaction Logic ---

            term.onKey(({ key, domEvent }) => {
                if (isLocked) return;

                const printable = !domEvent.altKey && !domEvent.ctrlKey && !domEvent.metaKey;

                if (domEvent.keyCode === 13) { // Enter
                    if (currentLine.trim().length > 0) {
                        term.write('\r\n');
                        const response = getAIResponse(currentLine);
                        
                        history.push({ user: currentLine, ai: response });
                        saveHistory();

                        if (response) {
                           typeResponse(response);
                        } else {
                           term.write(prompt); // For commands like 'clear'
                        }
                    }
                    else {
                        term.write(prompt);
                    }
                    currentLine = '';
                } else if (domEvent.keyCode === 8) { // Backspace
                    if (currentLine.length > 0) {
                        term.write('\b \b');
                        currentLine = currentLine.slice(0, -1);
                    }
                } else if (printable) {
                    currentLine += key;
                    term.write(key);
                }
            });

            // --- Initialization ---

            async function initialize() {
                figlet.parseFont('Standard', await (await fetch('https://unpkg.com/figlet@1.5.2/fonts/Standard.flf')).text());
                const banner = figlet.textSync('Lorel Axun', { font: 'Standard' });
                await typeResponse(banner, 5);
                await typeResponse("Benvenuto. Digita 'aiuto' per una lista di comandi.", 25);
                loadHistory();
                isLocked = false;
                term.write(prompt);
                term.focus();
            }

            initialize();
        });
    </script>
</body>
</html>